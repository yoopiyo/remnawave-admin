# Классификация типов провайдеров ASN

Система использует детальную классификацию типов провайдеров для более точного определения нарушений и применения предупреждений/банов.

## Типы провайдеров

### 1. `mobile` - Мобильные пулы
**Описание:** Точно мобильные пулы (CGNAT, LTE, GPRS)  
**Модификатор подозрительности:** ×0.3 (очень низкая)  
**Примеры:** CGNAT пулы, LTE сети, GPRS подключения

**Особенности:**
- Самый низкий уровень подозрительности
- Частые смены IP являются нормальным поведением
- Одновременные подключения с разных IP могут быть нормальными (CGNAT)

### 2. `mobile_isp` - Сети мобильных операторов
**Описание:** Сети мобильных операторов (MegaFon, MTS, Beeline, Tele2)  
**Модификатор подозрительности:** ×0.5 (низкая)  
**Примеры:** МТС, Мегафон, Билайн, Теле2, Yota, Ростелеком Мобайл

**Особенности:**
- Низкий уровень подозрительности
- Частые переключения между сетями (Wi-Fi ↔ мобильная) нормальны
- Учитывается при анализе временных паттернов

### 3. `fixed` - Проводной ШПД
**Описание:** Проводной широкополосный доступ (Broadband, DSL, GPON)  
**Модификатор подозрительности:** ×0.8 (норма)  
**Примеры:** Домашний интернет, DSL, GPON, FTTH, FTTB

**Особенности:**
- Стандартный тип для домашних подключений
- Стабильные IP адреса
- Редкие смены IP

### 4. `isp` - Крупные провайдеры
**Описание:** Крупные провайдеры (ER-Telecom, ТТК, Ростелеком)  
**Модификатор подозрительности:** ×1.0 (стандартный)  
**Примеры:** Ростелеком, ER-Telecom, ТТК, МТС Телеком

**Особенности:**
- Стандартный уровень подозрительности
- Могут обслуживать как домашних, так и корпоративных клиентов
- Широкое покрытие

### 5. `regional_isp` - Региональные ISP
**Описание:** Региональные интернет-провайдеры  
**Модификатор подозрительности:** ×1.0 (стандартный)  
**Примеры:** Региональные провайдеры, городские сети, муниципальные операторы

**Особенности:**
- Стандартный уровень подозрительности
- Ограниченное географическое покрытие
- Обычно обслуживают домашних клиентов

### 6. `business` - Корпоративные сети
**Описание:** Корпоративные сети (Yandex, Mail.ru)  
**Модификатор подозрительности:** ×1.2 (повышенное внимание)  
**Примеры:** Яндекс, Mail.ru, крупные корпорации

**Особенности:**
- Повышенное внимание при анализе
- Могут использоваться для шаринга аккаунтов
- Обычно стабильные IP адреса

### 7. `hosting` - Хостинг
**Описание:** Хостинг-провайдеры (Selectel, Timeweb, Beget, VDSina)  
**Модификатор подозрительности:** ×1.5 (высокое внимание)  
**Примеры:** Selectel, Timeweb, Beget, VDSina, датацентры

**Особенности:**
- Высокий уровень подозрительности
- Часто используются для шаринга и обхода ограничений
- Требует дополнительной проверки при обнаружении

### 8. `infrastructure` - Магистральная инфраструктура
**Описание:** Магистральная инфраструктура  
**Модификатор подозрительности:** ×1.3 (повышенное внимание)  
**Примеры:** Транзитные сети, пиринговые точки, магистральные операторы

**Особенности:**
- Повышенное внимание
- Редко используется конечными пользователями напрямую
- Может указывать на использование прокси/VPN

### 9. `vpn` - VPN/Proxy
**Описание:** VPN и прокси-сервисы  
**Модификатор подозрительности:** ×1.8 (очень высокое внимание)  
**Примеры:** VPN сервисы, прокси, анонимайзеры

**Особенности:**
- Очень высокий уровень подозрительности
- Часто используется для обхода ограничений
- Требует немедленной проверки

## Использование в системе предупреждений и банов

### Логика применения модификаторов

1. **Определение типа провайдера:**
   - Система проверяет локальную базу ASN по РФ
   - Если ASN найден в базе, используется тип из базы
   - Иначе используется эвристика на основе названия организации

2. **Расчёт модификатора:**
   - Для каждого типа провайдера применяется соответствующий модификатор
   - Если подключения с разных типов провайдеров, используется средний модификатор
   - Модификатор умножается на итоговый скор нарушения

3. **Оценка подозрительности:**
   - **Хостинг/датацентры:** +25 к скору, если обнаружены в активных подключениях
   - **VPN:** +15 к скору
   - **Корпоративные сети:** +10 к скору
   - **Магистральная инфраструктура:** +8 к скору
   - Если >70% подключений через подозрительные типы: +20 к скору
   - Если >50% подключений через подозрительные типы: +10 к скору

### Примеры работы

**Пример 1: Мобильный оператор**
- Пользователь подключается с IP мобильного оператора (mobile_isp)
- Модификатор: ×0.5
- Быстрое переключение между IP: скор 80 → 80 × 0.5 = 40 (низкая подозрительность)

**Пример 2: Хостинг**
- Пользователь подключается с IP хостинга (hosting)
- Модификатор: ×1.5
- Одновременные подключения: скор 85 → 85 × 1.5 = 127.5 → 100 (максимум, высокое внимание)

**Пример 3: Смешанные типы**
- Пользователь подключается с 2 IP: mobile_isp (×0.5) и hosting (×1.5)
- Средний модификатор: (0.5 + 1.5) / 2 = 1.0
- Скор нарушения умножается на 1.0

## Статистика по типам провайдеров

В меню "Система → Синхронизация ASN → Статус" отображается статистика по типам провайдеров:

- Общее количество ASN
- Количество активных ASN
- Распределение по типам провайдеров
- Дата последней синхронизации

## Обновление классификации

Классификация обновляется при синхронизации базы ASN:
- Автоматически при парсинге данных из RIPE Database
- На основе ключевых слов в названии организации и описании
- Приоритет проверки: от более специфичных типов к общим

## Рекомендации по использованию

1. **Регулярная синхронизация:** Обновляйте базу ASN раз в неделю для актуальных данных
2. **Мониторинг статистики:** Следите за распределением типов провайдеров в базе
3. **Настройка порогов:** При необходимости корректируйте модификаторы в `ASNAnalyzer.PROVIDER_TYPE_MODIFIERS`
4. **Анализ ложных срабатываний:** Если много ложных срабатываний для определённого типа, снизьте модификатор
