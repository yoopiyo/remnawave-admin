# ğŸ“‹ ĞŸĞ»Ğ°Ğ½ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ñ Remnawave Admin Bot

> **Ğ’ĞµÑ€ÑĞ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°:** 2.0
> **Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ:** 26.01.2026
> **ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 26.01.2026
> **Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:** 1.5.x

---

## ğŸ“Š Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

### âœ… Ğ§Ñ‚Ğ¾ ÑƒĞ¶Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾:
- Telegram Ğ±Ğ¾Ñ‚ Ğ½Ğ° aiogram 3.12 Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒÑ
- PostgreSQL Ğ±Ğ°Ğ·Ğ° Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ğ¼Ğ¸ users, nodes, hosts, user_connections
- REST API ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğº Remnawave (~60 Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ²)
- Webhook ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ real-time ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
- HWID ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ/ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ/Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹)
- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `user_connections` Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ IP Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ²
- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ¿Ğ¾ Ñ‚Ğ¾Ğ¿Ğ¸ĞºĞ°Ğ¼
- ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### âŒ Ğ§ĞµĞ³Ğ¾ Ğ½Ğµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚:
- Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ IP Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
- Ğ£Ğ¼Ğ½Ğ¾Ğµ Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²
- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ (Ğ±Ğ¾Ñ‚ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²)
- Ğ’ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ

---

## ğŸ¯ Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ†ĞµĞ»Ğ¸

1. **Anti-Abuse ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°** â€” Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ ÑˆĞ°Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ²
2. **Ğ‘Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³ Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ñ‹** â€” Ğ³Ğ¸Ğ±ĞºĞ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğ¹
3. **Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°** â€” Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹
4. **Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ** â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ñ‹Ğ¹ UI Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
5. **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** â€” Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¸ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ Ğ±ĞµĞ· Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¼ĞµÑˆĞ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ°

> **ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ:** Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ â€” **Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ**. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ» Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ½Ğµ Ğ¿Ñ€ĞµĞ´ÑƒÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½.

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 1: Anti-Abuse ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° (Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ)

### 1.1 ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ IP Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹

**Ğ¦ĞµĞ»ÑŒ:** ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… IP Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**

```
[ ] Ğ Ğ°ÑÑˆĞ¸Ñ€Ğ¸Ñ‚ÑŒ webhook Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ´Ğ»Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
    - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ user.connected / user.disconnected ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
    - Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ IP, Ğ²Ñ€ĞµĞ¼Ñ, Ğ½Ğ¾Ğ´Ñƒ Ğ² user_connections
    - Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑŒ User-Agent Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

[ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸Ñ ConnectionMonitor
    - ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹ (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 30-60 ÑĞµĞº)
    - Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº Remnawave API Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ online Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
    - Ğ¡Ğ¾Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ IP Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ² Ñ HWID Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ¼

[ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ² database.py:
    - get_active_connections_count(user_uuid) -> int
    - get_unique_ips_in_window(user_uuid, window_minutes) -> int
    - get_connection_history(user_uuid, days) -> List[Connection]
    - get_ip_metadata(ip_address) -> IPMetadata
```

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:**
```python
class ConnectionEvent:
    user_uuid: str
    ip_address: str
    node_uuid: str
    connected_at: datetime
    disconnected_at: Optional[datetime]
    user_agent: Optional[str]
    device_fingerprint: Optional[str]

class IPMetadata:
    ip_address: str
    country_code: str
    city: str
    asn: str
    asn_org: str  # ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
    ip_type: str  # 'residential', 'mobile', 'datacenter', 'vpn'
    is_proxy: bool
    is_vpn: bool
    is_tor: bool
```

---

## ğŸ§  1.2 Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ°

ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° `IF unique_ips > hwid_limit THEN block` Ğ´Ğ°Ñ‘Ñ‚ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ **Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğ¹**:

| Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ | IP Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ? | Ğ­Ñ‚Ğ¾ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ? |
|----------|--------------|----------------|
| ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ğ»ÑÑ Ñ WiFi Ğ½Ğ° 4G | Ğ”Ğ° | âŒ ĞĞµÑ‚ |
| ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚ (CGNAT, Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ IP) | Ğ”Ğ°, Ñ‡Ğ°ÑÑ‚Ğ¾ | âŒ ĞĞµÑ‚ |
| ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ² Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞµ (Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°) | Ğ”Ğ° | âŒ ĞĞµÑ‚ |
| ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€Ğ°Ğ·Ğ´Ğ°Ğ» Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚ Ğ´Ñ€ÑƒĞ·ÑŒÑĞ¼ | Ğ”Ğ° | âœ… Ğ”Ğ° |
| ĞĞ´Ğ¸Ğ½ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ñ VPN (Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²ĞµÑ€Ñ‹) | Ğ”Ğ° | âŒ ĞĞµÑ‚ |
| ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ° Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ° Ğ½Ğ° Ñ„Ğ¾Ñ€ÑƒĞ¼Ğµ | Ğ”Ğ° | âœ… Ğ”Ğ° |

### ĞœĞ½Ğ¾Ğ³Ğ¾Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·

**Ğ¦ĞµĞ»ÑŒ:** ĞÑ‚Ğ»Ğ¸Ñ‡Ğ°Ñ‚ÑŒ Ğ»ĞµĞ³Ğ¸Ñ‚Ğ¸Ğ¼Ğ½ÑƒÑ ÑĞ¼ĞµĞ½Ñƒ IP Ğ¾Ñ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑˆĞ°Ñ€Ğ¸Ğ½Ğ³Ğ°

```
[ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸Ñ IntelligentViolationDetector (services/violation_detector.py)
```

#### Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€ 1: Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½

```python
class TemporalAnalyzer:
    """
    ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² ÑĞ¼ĞµĞ½Ñ‹ IP
    """

    def analyze(self, connections: List[Connection]) -> TemporalScore:
        # Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ IP (< 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹) = Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
        # ĞĞ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ IP Ğ³ĞµĞ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ´Ğ°Ğ»ĞµĞºĞ¸

        # ĞŸĞ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ°Ñ ÑĞ¼ĞµĞ½Ğ° IP Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ½Ñ = Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾

        # ĞĞ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… IP = Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
        pass

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
# âœ… OK: IP1 (09:00-12:00) â†’ IP2 (12:05-18:00) â†’ IP1 (18:30-23:00)
#    Ğ§ĞµĞ»Ğ¾Ğ²ĞµĞº ÑƒÑˆÑ‘Ğ» Ğ¸Ğ· Ğ´Ğ¾Ğ¼Ğ°, Ğ²ĞµÑ€Ğ½ÑƒĞ»ÑÑ
#
# âš ï¸ SUSPICIOUS: IP1 (09:00-09:01) â†’ IP2 (09:02-09:03) â†’ IP3 (09:04-...)
#    Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
#
# ğŸš¨ VIOLATION: IP1 Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ 09:00-12:00 Ğ˜ IP2 Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ 09:30-11:00
#    ĞĞ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ = Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:**

| ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ | Ğ¡ĞºĞ¾Ñ€ | Ğ˜Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ |
|---------|------|---------------|
| ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ¼ĞµĞ½Ğ° IP (gap > 5 Ğ¼Ğ¸Ğ½) | 0 | ĞĞ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ |
| Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑĞ¼ĞµĞ½Ğ° IP (gap < 1 Ğ¼Ğ¸Ğ½), Ğ±Ğ»Ğ¸Ğ·ĞºĞ¸Ğµ Ğ³ĞµĞ¾ | +10 | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ÑĞµÑ‚Ğ¸ |
| Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑĞ¼ĞµĞ½Ğ° IP, Ğ´Ğ°Ğ»Ñ‘ĞºĞ¸Ğµ Ğ³ĞµĞ¾ | +40 | ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ |
| **ĞĞ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ** | +80 | ĞŸĞ¾Ñ‡Ñ‚Ğ¸ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ |
| ĞĞ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ > 3 IP | +100 | Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ |

#### Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€ 2: Ğ“ĞµĞ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·

```python
class GeoAnalyzer:
    """
    ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ³ĞµĞ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ IP
    """

    def analyze(self, ip_addresses: List[IPMetadata]) -> GeoScore:
        # Ğ’ÑĞµ IP Ğ¸Ğ· Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ° = Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾
        # IP Ğ¸Ğ· Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ° = Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ
        # IP Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ = Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
        # "Impossible travel" = Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ
        pass

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
# âœ… OK: ĞœĞ¾ÑĞºĞ²Ğ° â†’ ĞœĞ¾ÑĞºĞ²Ğ° â†’ ĞœĞ¾ÑĞºĞ²Ğ° (Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹)
# âœ… OK: ĞœĞ¾ÑĞºĞ²Ğ° (ÑƒÑ‚Ñ€Ğ¾) â†’ Ğ¡ĞŸĞ± (Ğ²ĞµÑ‡ĞµÑ€) - Ğ¿Ğ¾ĞµĞ·Ğ´ 4 Ñ‡Ğ°ÑĞ°, Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾
# âš ï¸ SUSPICIOUS: ĞœĞ¾ÑĞºĞ²Ğ° â†’ Ğ‘ĞµÑ€Ğ»Ğ¸Ğ½ Ğ·Ğ° 1 Ñ‡Ğ°Ñ (Ğ½ĞµÑ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ñ„Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¸)
# ğŸš¨ VIOLATION: ĞœĞ¾ÑĞºĞ²Ğ° Ğ˜ Ğ‘ĞµÑ€Ğ»Ğ¸Ğ½ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ³ĞµĞ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:**

| ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ | Ğ¡ĞºĞ¾Ñ€ | Ğ˜Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ |
|---------|------|---------------|
| Ğ’ÑĞµ IP Ğ¸Ğ· Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ° | 0 | ĞĞ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ |
| IP Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹ | +5 | ĞĞ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ (Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ/ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°) |
| IP Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½, Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾, Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ | +15 | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ |
| IP Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½, Ğ½ĞµÑ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ | +50 | Impossible travel |
| IP Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ | +90 | Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ |

**Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° "Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸" Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ:**
```python
TRAVEL_SPEEDS = {
    'same_city': 50,      # ĞºĞ¼/Ñ‡ (Ñ‚Ğ°ĞºÑĞ¸/Ğ¼ĞµÑ‚Ñ€Ğ¾)
    'same_country': 200,  # ĞºĞ¼/Ñ‡ (Ğ¿Ğ¾ĞµĞ·Ğ´/Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°)
    'international': 800, # ĞºĞ¼/Ñ‡ (ÑĞ°Ğ¼Ğ¾Ğ»Ñ‘Ñ‚)
}

def is_travel_realistic(loc1, loc2, time_diff_hours):
    distance = haversine(loc1, loc2)
    max_distance = TRAVEL_SPEEDS['international'] * time_diff_hours
    return distance <= max_distance
```

#### Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€ 3: Ğ¢Ğ¸Ğ¿ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° (ASN Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·)

```python
class ASNAnalyzer:
    """
    ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ‚Ğ¸Ğ¿Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚-Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
    """

    # ĞšĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ ASN
    ASN_TYPES = {
        'mobile': ['MTS', 'Beeline', 'MegaFon', 'Tele2', 'Yota', ...],
        'residential': ['Rostelecom', 'ER-Telecom', 'TTK', ...],
        'datacenter': ['DigitalOcean', 'AWS', 'Hetzner', 'OVH', ...],
        'vpn': ['NordVPN', 'ExpressVPN', 'Mullvad', ...],
    }

    def analyze(self, ip_metadata: List[IPMetadata]) -> ASNScore:
        # ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ = Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼ Ñ‡Ğ°ÑÑ‚ÑƒÑ ÑĞ¼ĞµĞ½Ñƒ IP
        # Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ = Ñ€ĞµĞ´ĞºĞ°Ñ ÑĞ¼ĞµĞ½Ğ° IP
        # Ğ”Ğ°Ñ‚Ğ°Ñ†ĞµĞ½Ñ‚Ñ€/VPN = Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ»ĞµĞ³Ğ¸Ñ‚Ğ¸Ğ¼Ğ½Ğ¾, Ğ½Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ½Ğ¾Ğµ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ
        pass
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° ASN Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:**

| Ğ¢Ğ¸Ğ¿ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° | ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ¾Ğµ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ | ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ ÑĞºĞ¾Ñ€Ğ° |
|----------------|---------------------|-------------------|
| Mobile carrier | Ğ§Ğ°ÑÑ‚Ğ°Ñ ÑĞ¼ĞµĞ½Ğ° IP, CGNAT | Ã—0.5 (ÑĞ½Ğ¸Ğ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ) |
| Residential ISP | Ğ ĞµĞ´ĞºĞ°Ñ ÑĞ¼ĞµĞ½Ğ° IP | Ã—1.0 (ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹) |
| Datacenter | ĞĞµ Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ | Ã—1.5 |
| Known VPN | ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ»ĞµĞ³Ğ¸Ñ‚Ğ¸Ğ¼Ğ½Ğ¾ | Ã—1.2 |
| Tor exit node | Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº | Ã—2.0 |

#### Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€ 4: Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

```python
class UserProfileAnalyzer:
    """
    Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    """

    def build_baseline(self, user_uuid: str, days: int = 30) -> UserBaseline:
        """
        Ğ¡Ñ‚Ñ€Ğ¾Ğ¸Ğ¼ "Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹" Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        """
        return UserBaseline(
            typical_countries=['RU'],
            typical_cities=['Moscow', 'Saint Petersburg'],
            typical_asns=['MTS', 'Beeline'],
            avg_daily_unique_ips=2.3,
            max_daily_unique_ips=5,
            typical_connection_hours=[9, 10, 11, 18, 19, 20, 21, 22],
            avg_session_duration_minutes=45,
        )

    def analyze(self, current_behavior, baseline) -> ProfileScore:
        # Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ ÑĞ¸Ğ»ÑŒĞ½Ğ¾ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ³Ğ¾ = Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
        # ĞŸĞ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² = Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ baseline
        pass
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:**

| ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ baseline | Ğ¡ĞºĞ¾Ñ€ | Ğ˜Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ |
|------------------------|------|---------------|
| Ğ’ Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ°Ñ… Ğ½Ğ¾Ñ€Ğ¼Ñ‹ | 0 | ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ |
| Unique IPs > avg Ã— 1.5 | +15 | ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğµ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ |
| Unique IPs > avg Ã— 2 | +30 | Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ |
| Unique IPs > max Ğ·Ğ° Ğ²ÑÑ‘ Ğ²Ñ€ĞµĞ¼Ñ | +45 | ĞĞ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ñ |
| ĞĞ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ° (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·) | +20 | Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ |
| ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° | +10 | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¼ĞµĞ½Ğ¸Ğ» Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ° |

#### Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€ 5: ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² (Device Fingerprinting)

```python
class DeviceFingerprintAnalyzer:
    """
    ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸Ğº ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²
    """

    def extract_fingerprint(self, connection: Connection) -> DeviceFingerprint:
        # Ğ˜Ğ· User-Agent Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        return DeviceFingerprint(
            os_family='Android',
            os_version='13',
            client_type='V2RayNG',
            client_version='1.8.5',
            screen_resolution=None,  # ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾
            timezone=None,           # ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾
        )

    def analyze(self, fingerprints: List[DeviceFingerprint]) -> DeviceScore:
        # Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ĞĞ¡ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ = Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°
        # ĞĞ´Ğ¸Ğ½ fingerprint, Ğ½Ğ¾ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ IP = Ğ¾Ğ´Ğ¸Ğ½ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑĞµÑ‚Ğ¸
        pass
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²:**

| ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ | Ğ¡ĞºĞ¾Ñ€ | Ğ˜Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ |
|---------|------|---------------|
| ĞĞ´Ğ¸Ğ½ fingerprint, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ IP | 0 | ĞĞ´Ğ¸Ğ½ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº, Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑĞµÑ‚Ğ¸ |
| Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ²ĞµÑ€ÑĞ¸Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° | +10 | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ |
| Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹ (V2RayNG + Shadowrocket) | +25 | Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° |
| Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ĞĞ¡ (Android + iOS + Windows) | +40 | Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° |
| > 3 Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… fingerprint Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ | +60 | ĞœĞ½Ğ¾Ğ³Ğ¾ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² |

### ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğ¹ ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹

```python
class ViolationScorer:
    """
    ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµÑ‚ Ğ²ÑĞµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹ Ğ² ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ ÑĞºĞ¾Ñ€
    """

    WEIGHTS = {
        'temporal': 0.25,      # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½
        'geo': 0.25,           # Ğ“ĞµĞ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ
        'asn': 0.15,           # Ğ¢Ğ¸Ğ¿ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
        'profile': 0.20,       # ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ
        'device': 0.15,        # Fingerprint ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²
    }

    THRESHOLDS = {
        'no_action': 30,       # < 30: Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°ĞµĞ¼
        'monitor': 50,         # 30-50: ÑƒÑĞ¸Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³
        'warn': 65,            # 50-65: Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        'soft_block': 80,      # 65-80: Ğ¼ÑĞ³ĞºĞ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° (Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸)
        'temp_block': 90,      # 80-90: Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°
        'hard_block': 95,      # > 95: Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° + Ñ€ÑƒÑ‡Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
    }

    def calculate_score(self, user_uuid: str) -> ViolationScore:
        temporal = self.temporal_analyzer.analyze(...)
        geo = self.geo_analyzer.analyze(...)
        asn = self.asn_analyzer.analyze(...)
        profile = self.profile_analyzer.analyze(...)
        device = self.device_analyzer.analyze(...)

        # Ğ’Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°
        raw_score = (
            temporal.score * self.WEIGHTS['temporal'] +
            geo.score * self.WEIGHTS['geo'] +
            asn.score * self.WEIGHTS['asn'] +
            profile.score * self.WEIGHTS['profile'] +
            device.score * self.WEIGHTS['device']
        )

        # ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹
        if asn.is_mobile_carrier:
            raw_score *= 0.7  # Ğ¡Ğ½Ğ¸Ğ¶Ğ°ĞµĞ¼ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ…

        if self.has_simultaneous_connections(user_uuid):
            raw_score = max(raw_score, 85)  # ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 85 Ğ¿Ñ€Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…

        return ViolationScore(
            total=raw_score,
            breakdown={
                'temporal': temporal,
                'geo': geo,
                'asn': asn,
                'profile': profile,
                'device': device,
            },
            recommended_action=self.get_action(raw_score),
            confidence=self.calculate_confidence(...),
        )
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

#### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 1: Ğ›ĞµĞ³Ğ¸Ñ‚Ğ¸Ğ¼Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ¾Ğ¼
```
ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: @ivan
HWID Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 3
Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… IP Ğ·Ğ° Ğ´ĞµĞ½ÑŒ: 8

ĞĞ½Ğ°Ğ»Ğ¸Ğ·:
- Temporal: +5 (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ¼ĞµĞ½Ğ°, Ğ½ĞµÑ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…)
- Geo: 0 (Ğ²ÑĞµ IP Ğ¸Ğ· ĞœĞ¾ÑĞºĞ²Ñ‹)
- ASN: Ã—0.5 Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ (ĞœĞ¢Ğ¡ - Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€)
- Profile: +10 (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ 5-6 IP, ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ 8)
- Device: 0 (Ğ¾Ğ´Ğ¸Ğ½ fingerprint - Android/V2RayNG)

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: (5 + 0 + 0 + 10 + 0) Ã— 0.7 = 10.5

Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: âœ… ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ (< 30)
```

#### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 2: ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑˆĞ°Ñ€Ğ¸Ğ½Ğ³
```
ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: @alice
HWID Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 2
Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… IP Ğ·Ğ° Ğ´ĞµĞ½ÑŒ: 6

ĞĞ½Ğ°Ğ»Ğ¸Ğ·:
- Temporal: +80 (3 Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ!)
- Geo: +50 (ĞœĞ¾ÑĞºĞ²Ğ° + Ğ‘ĞµÑ€Ğ»Ğ¸Ğ½ + ĞšĞ¸ĞµĞ² Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾)
- ASN: Ã—1.0 (residential ISPs)
- Profile: +45 (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ 1-2 IP, Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ñ)
- Device: +40 (Android + iOS + Windows Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾)

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: (80Ã—0.25 + 50Ã—0.25 + 0 + 45Ã—0.20 + 40Ã—0.15) = 20 + 12.5 + 9 + 6 = 47.5
+ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ·Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ = max(47.5, 85) = 85

Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: ğŸ”’ Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°
```

#### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 3: ĞŸÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¸Ğº
```
ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: @traveler
HWID Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 3
Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… IP Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ: 15

ĞĞ½Ğ°Ğ»Ğ¸Ğ·:
- Temporal: +5 (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ¼ĞµĞ½Ğ°, 1-2 IP Ğ² Ğ´ĞµĞ½ÑŒ)
- Geo: +15 (ĞœĞ¾ÑĞºĞ²Ğ° â†’ Ğ¡Ñ‚Ğ°Ğ¼Ğ±ÑƒĞ» â†’ Ğ”ÑƒĞ±Ğ°Ğ¹, Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹)
- ASN: Ã—1.0 (Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ residential)
- Profile: +20 (Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹, Ğ½Ğ¾ Ğ¿Ğ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾)
- Device: 0 (Ğ¾Ğ´Ğ¸Ğ½ fingerprint)

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: (5 + 15 + 0 + 20 + 0) = 40

Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: ğŸ‘ Ğ£ÑĞ¸Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³, Ğ½Ğ¾ Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
```

### Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ (Confidence)

```python
class ConfidenceCalculator:
    """
    ĞÑ†ĞµĞ½ĞºĞ° ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ² Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¸
    """

    def calculate(self, violation_score: ViolationScore) -> Confidence:
        factors = []

        # Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ
        if violation_score.has_simultaneous_connections:
            factors.append(('simultaneous', 0.95))

        if violation_score.device.different_os_count >= 3:
            factors.append(('multiple_os', 0.90))

        # Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ
        if violation_score.geo.impossible_travel:
            factors.append(('impossible_travel', 0.85))

        # ĞĞ¸Ğ·ĞºĞ°Ñ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ (Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°)
        if violation_score.total > 70 and not factors:
            factors.append(('score_only', 0.60))

        return Confidence(
            level=max(f[1] for f in factors) if factors else 0.5,
            factors=factors,
            requires_human_review=any(f[1] < 0.75 for f in factors),
        )
```

**Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**

| Confidence | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ |
|------------|----------|----------|
| > 0.90 | ĞÑ‡ĞµĞ½ÑŒ Ğ²Ñ‹ÑĞ¾ĞºĞ°Ñ | ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ |
| 0.75 - 0.90 | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ | ĞĞ²Ñ‚Ğ¾-Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ + ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñƒ |
| 0.60 - 0.75 | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñƒ, Ğ¶Ğ´Ñ‘Ğ¼ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ |
| < 0.60 | ĞĞ¸Ğ·ĞºĞ°Ñ | Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³, Ğ½ÑƒĞ¶ĞµĞ½ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº |

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 1.3: ĞœĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸

**Ğ¦ĞµĞ»ÑŒ:** Ğ“Ñ€Ğ°Ğ´ÑƒĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ½Ñ‹Ñ… Ğ¼ĞµÑ€

### Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹

```python
class ActionType(Enum):
    MONITOR = "monitor"           # Ğ£ÑĞ¸Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³
    WARN = "warn"                 # ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    SOFT_LIMIT = "soft_limit"     # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸
    DISCONNECT = "disconnect"     # ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
    TEMP_BLOCK = "temp_block"     # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°
    PERMANENT_BLOCK = "perm_block"# Ğ‘Ğ°Ğ½ Ğ´Ğ¾ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€Ğ°
```

### ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ°Ñ ÑÑĞºĞ°Ğ»Ğ°Ñ†Ğ¸Ñ

```python
ESCALATION_MATRIX = {
    # (severity, violation_count) -> action
    ('low', 1): ('warn', None),
    ('low', 2): ('warn', None),
    ('low', 3): ('soft_limit', '30m'),

    ('medium', 1): ('warn', None),
    ('medium', 2): ('temp_block', '1h'),
    ('medium', 3): ('temp_block', '6h'),

    ('high', 1): ('temp_block', '1h'),
    ('high', 2): ('temp_block', '24h'),
    ('high', 3): ('temp_block', '7d'),

    ('critical', 1): ('temp_block', '24h'),
    ('critical', 2): ('permanent_block', None),
}
```

### ĞœĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ "Ğ¼ÑĞ³ĞºĞ¾Ğ¹ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸" (Soft Limit)

```python
class SoftLimiter:
    """
    ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
    """

    async def apply_soft_limit(self, user_uuid: str, duration: str):
        """
        Ğ’Ğ¼ĞµÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸:
        1. ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ´Ğ¾ 1 Mbit/s
        2. ĞÑ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ²ÑĞµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ ĞºÑ€Ğ¾Ğ¼Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾
        3. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        """
        # Kick Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ
        active = await self.get_active_connections(user_uuid)
        if len(active) > 1:
            # ĞÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ°Ğ¼Ğ¾Ğµ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ
            for conn in sorted(active, key=lambda x: x.connected_at)[1:]:
                await self.disconnect(conn)

        # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸
        await self.api.update_user(user_uuid, speed_limit=1024*1024)  # 1 MB/s

        # ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ½ÑÑ‚Ğ¸Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
        await self.schedule_remove_limit(user_uuid, duration)
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° temp_blocks (Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ)

```sql
CREATE TABLE temp_blocks (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,

    -- ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
    reason VARCHAR(255) NOT NULL,
    violation_id INT REFERENCES violations(id),
    violation_score DECIMAL(5,2),
    confidence DECIMAL(3,2),

    -- Ğ¢Ğ¸Ğ¿ Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
    block_type VARCHAR(50) NOT NULL,  -- 'soft_limit', 'temp_block', 'permanent'
    speed_limit_bytes INT,            -- Ğ´Ğ»Ñ soft_limit

    -- Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ€Ğ°Ğ¼ĞºĞ¸
    blocked_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    unblock_at TIMESTAMP WITH TIME ZONE,
    actual_unblock_at TIMESTAMP WITH TIME ZONE,

    -- ĞšÑ‚Ğ¾ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ»
    blocked_by VARCHAR(50) NOT NULL,  -- 'auto:high_confidence', 'auto:medium', 'admin:123456'

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    is_active BOOLEAN DEFAULT TRUE,
    was_appealed BOOLEAN DEFAULT FALSE,
    appeal_result VARCHAR(50),  -- 'approved', 'rejected', 'modified'

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    metadata JSONB  -- snapshot Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ° Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
);
```

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 1.4: Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ

### Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼

```
[ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ¿Ğ¸Ğº notifications_topic_violations

[ ] Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ»Ñ Ğ’Ğ«Ğ¡ĞĞšĞĞ™ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:
    ğŸš¨ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°

    ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: @username (uuid: xxx)
    ğŸ“Š Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ HWID: 3 | ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… IP: 7
    ğŸ¯ Ğ¡ĞºĞ¾Ñ€: 92/100 | Ğ£Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ: 95%

    ğŸ“ Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ:
       â€¢ âš ï¸ 3 Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ
       â€¢ ğŸŒ Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹: RU, DE, UA
       â€¢ ğŸ“± Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ĞĞ¡: Android, iOS, Windows

    ğŸ”’ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ½Ğ° 24 Ñ‡Ğ°ÑĞ°
    â° Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°: 27.01.2026 15:30 UTC

    [âœ… ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ] [â° Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑÑ€Ğ¾Ğº] [âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ]

[ ] Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ»Ñ Ğ¡Ğ Ğ•Ğ”ĞĞ•Ğ™ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:
    âš ï¸ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°

    ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: @username
    ğŸ“Š Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ HWID: 3 | ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… IP: 5
    ğŸ¯ Ğ¡ĞºĞ¾Ñ€: 72/100 | Ğ£Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ: 68%

    ğŸ“ ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹:
       â€¢ ğŸ“ˆ ĞĞ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ñ: Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ 2 IP, ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ 5
       â€¢ ğŸŒ ĞĞ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ°: Ğ“ĞµÑ€Ğ¼Ğ°Ğ½Ğ¸Ñ (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·)

    â“ Ğ¡Ğ¼ÑĞ³Ñ‡Ğ°ÑÑ‰Ğ¸Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹:
       â€¢ ğŸ“± ĞĞ´Ğ¸Ğ½ fingerprint (V2RayNG/Android)
       â€¢ â± ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ¼ĞµĞ½Ğ° IP (Ğ½Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾)

    ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ: ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

    [ğŸ‘ ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³] [âš ï¸ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ´Ğ¸Ñ‚ÑŒ] [ğŸ”’ Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ]
```

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 1.5: ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Anti-Abuse (Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğµ)

```python
ANTI_ABUSE_SETTINGS = {
    # ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹
    'enabled': True,
    'detection_interval_seconds': 60,

    # ĞŸĞ¾Ñ€Ğ¾Ğ³Ğ¸ ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
    'score_thresholds': {
        'monitor': 30,
        'warn': 50,
        'soft_limit': 65,
        'temp_block': 80,
        'hard_block': 95,
    },

    # Ğ’ĞµÑĞ° Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¾Ğ² (ÑÑƒĞ¼Ğ¼Ğ° = 1.0)
    'factor_weights': {
        'temporal': 0.25,
        'geo': 0.25,
        'asn': 0.15,
        'profile': 0.20,
        'device': 0.15,
    },

    # ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹
    'modifiers': {
        'mobile_carrier_multiplier': 0.7,
        'datacenter_multiplier': 1.5,
        'vpn_multiplier': 1.2,
        'new_user_grace_period_days': 7,  # ĞĞ¾Ğ²Ñ‹Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·. Ğ´Ğ°Ñ‘Ğ¼ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ
    },

    # Ğ­ÑĞºĞ°Ğ»Ğ°Ñ†Ğ¸Ñ
    'escalation': {
        'violation_memory_days': 30,  # ĞŸĞ¾Ğ¼Ğ½Ğ¸Ğ¼ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ 30 Ğ´Ğ½ĞµĞ¹
        'reset_after_clean_days': 60, # Ğ¡Ğ±Ñ€Ğ¾Ñ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ° Ğ¿Ğ¾ÑĞ»Ğµ 60 Ğ´Ğ½ĞµĞ¹ Ğ±ĞµĞ· Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹
    },

    # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ°
    'auto_actions': {
        'high_confidence_threshold': 0.85,  # ĞĞ²Ñ‚Ğ¾-Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ñ€Ğ¸ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ > 85%
        'require_human_below': 0.70,         # Ğ¢Ñ€ĞµĞ±ÑƒĞµĞ¼ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ° Ğ¿Ñ€Ğ¸ < 70%
    },

    # Whitelist
    'whitelist': {
        'user_uuids': [],
        'ip_ranges': ['10.0.0.0/8', '192.168.0.0/16'],  # Internal
        'asns': [],  # Trusted ASNs
    },

    # Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²)
    'notifications': {
        'admin_on_violation': True,
        'admin_on_block': True,
        'admin_on_unblock': True,
    },
}
```

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 2: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°Ğ¼Ğ¸ Ğ¸ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¸

### 2.1 Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°Ğ¼Ğ¸ (Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²)

**Ğ¦ĞµĞ»ÑŒ:** ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğ°Ğ´ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°Ğ¼Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**

```
[ ] Ğ Ğ°Ğ·Ğ´ĞµĞ» "ğŸ”’ Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸" Ğ² Telegram Ğ±Ğ¾Ñ‚Ğµ:
    â”œâ”€â”€ ğŸ“‹ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
    â”‚   â””â”€â”€ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒÑ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
    â”œâ”€â”€ ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº
    â”‚   â””â”€â”€ ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ/Ğ´Ğ°Ñ‚Ğµ
    â”œâ”€â”€ â• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºÑƒ
    â”‚   â””â”€â”€ Ğ ÑƒÑ‡Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹
    â””â”€â”€ âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸

[ ] ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸:
    ğŸ”’ Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° #1234

    ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: @username
    ğŸ“Š Ğ¢Ğ¸Ğ¿: temp_block (24 Ñ‡Ğ°ÑĞ°)
    ğŸ¯ Ğ¡ĞºĞ¾Ñ€: 85/100 | Ğ£Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ: 92%

    ğŸ“ ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: device_limit_exceeded
       â€¢ 3 Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ
       â€¢ Ğ¡Ñ‚Ñ€Ğ°Ğ½Ñ‹: RU, DE, UA

    â° Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: 26.01.2026 12:00
    â° Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°: 27.01.2026 12:00

    [âœ… Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ] [â° Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑÑ€Ğ¾Ğº] [ğŸ“ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºÑƒ]
```

### 2.2 Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¹ (Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²)

**Ğ¦ĞµĞ»ÑŒ:** ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ

> **Ğ’Ğ°Ğ¶Ğ½Ğ¾:** ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ÑÑ Ğ² Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ (Telegram, email), Ğ°Ğ´Ğ¼Ğ¸Ğ½ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ñ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**

```
[ ] Ğ Ğ°Ğ·Ğ´ĞµĞ» "ğŸ“ ĞĞ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¸" Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ±Ğ¾Ñ‚Ğµ:
    â”œâ”€â”€ ğŸ“‹ ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¸
    â”œâ”€â”€ âœ… Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ½Ñ‹Ğµ
    â””â”€â”€ â• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ñ

[ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ¼:
    ğŸ“ ĞĞ¾Ğ²Ğ°Ñ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ñ

    ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: [ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ username/UUID]
    ğŸ”’ Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°: [Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ°]

    ğŸ“‚ ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ:
    â—‹ ĞŸÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ / ÑĞ¼ĞµĞ½Ğ° Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸
    â—‹ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ VPN
    â—‹ Ğ¡Ğ¼ĞµĞ½Ğ° ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°
    â—‹ Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°
    â—‹ Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ

    ğŸ“ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ:
    [Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ]

    [ğŸ’¾ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ñ]

[ ] Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ¸Ğµ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¸:
    ğŸ“‹ ĞĞ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ñ #1234

    ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: @username
    ğŸ”’ Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°: 24 Ñ‡Ğ°ÑĞ° Ğ·Ğ° device_limit_exceeded
    ğŸ“ ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ: ĞŸÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ
    ğŸ’¬ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: "Ğ‘Ñ‹Ğ» Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸Ñ€Ğ¾Ğ²ĞºĞµ, Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°Ğ»ÑÑ Ğ¸Ğ· Ğ¾Ñ‚ĞµĞ»Ñ"

    ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ IP Ğ¸Ğ· ĞœĞ¾ÑĞºĞ²Ñ‹ â†’ Ğ¡Ñ‚Ğ°Ğ¼Ğ±ÑƒĞ»Ğ° â†’ Ğ”ÑƒĞ±Ğ°Ñ        â”‚
    â”‚ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹: Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ (6-8 Ñ‡Ğ°ÑĞ¾Ğ²)    â”‚
    â”‚ Fingerprint: Ğ¾Ğ´Ğ¸Ğ½ (iPhone/Shadowrocket) â”‚
    â”‚ ĞĞ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹: ĞĞ•Ğ¢          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ: Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ Ğ»ĞµĞ³Ğ¸Ñ‚Ğ¸Ğ¼Ğ½Ğ¾ (78%)

    [âœ… ĞĞ´Ğ¾Ğ±Ñ€Ğ¸Ñ‚ÑŒ] [âœ… ĞĞ´Ğ¾Ğ±Ñ€Ğ¸Ñ‚ÑŒ + Whitelist] [âŒ ĞÑ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ñ‚ÑŒ]

[ ] Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ğ¸:
    - ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ°Ñ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°
    - Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Trust Score (+10)
    - ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² whitelist
    - Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
```

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 3: Ğ‘Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³ Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ñ‹

### 3.1 Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²

```
[ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ¾Ğ¼ Remnawave

[ ] Ğ”Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ¿Ğ¾ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ğ¼:

    ğŸ“¦ BASIC (Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹)
    - HWID Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 1 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾
    - Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ¸Ğ¹ Anti-Abuse
    - ĞĞµÑ‚ grace period

    ğŸ“¦ STANDARD (ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹)
    - HWID Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 3 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°
    - Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Anti-Abuse
    - 7 Ğ´Ğ½ĞµĞ¹ grace period

    ğŸ“¦ PREMIUM (Ğ¿Ñ€ĞµĞ¼Ğ¸ÑƒĞ¼)
    - HWID Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 5 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²
    - ĞœÑĞ³ĞºĞ¸Ğ¹ Anti-Abuse (Ğ²Ñ‹ÑˆĞµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¸)
    - 14 Ğ´Ğ½ĞµĞ¹ grace period

    ğŸ“¦ FAMILY (ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹)
    - HWID Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 10 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²
    - ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Anti-Abuse
    - ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ³ĞµĞ¾-Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸
```

### 3.2 ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ğ¾ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³Ñƒ

```
[ ] ĞŸÑ€Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞµ Ğ·Ğ° Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ:
    - ĞŸÑ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (Ğ¿Ğ°ÑƒĞ·Ğ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸)
    - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸

[ ] Ğ¨Ñ‚Ñ€Ğ°Ñ„Ğ½Ñ‹Ğµ ÑĞ°Ğ½ĞºÑ†Ğ¸Ğ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾):
    - 3+ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ Ğ·Ğ° Ğ¼ĞµÑÑÑ† = -7 Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
    - ĞŸĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ = Ğ¿Ğ¾Ğ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°
```

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 4: Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°

### 4.1 Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ IP (Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ)

```
[ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ MaxMind GeoLite2 Ğ¸Ğ»Ğ¸ ip-api.com

[ ] Ğ Ğ°ÑÑˆĞ¸Ñ€Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ user_connections:
    ALTER TABLE user_connections ADD COLUMN
        country_code VARCHAR(2),
        country_name VARCHAR(100),
        city VARCHAR(100),
        region VARCHAR(100),
        latitude DECIMAL(9,6),
        longitude DECIMAL(9,6),
        timezone VARCHAR(50),
        asn INT,
        asn_org VARCHAR(200),
        connection_type VARCHAR(20),  -- 'residential', 'mobile', 'datacenter'
        is_proxy BOOLEAN DEFAULT FALSE,
        is_vpn BOOLEAN DEFAULT FALSE,
        is_tor BOOLEAN DEFAULT FALSE;
```

### 4.2 Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ (Telegram)

```
[ ] ĞĞ¾Ğ²Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /analytics Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ² Ğ¼ĞµĞ½Ñ

[ ] Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Anti-Abuse Ğ·Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´:
    ğŸ“Š Anti-Abuse ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° (7 Ğ´Ğ½ĞµĞ¹)

    ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹: 1,234
    âš ï¸ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹: 45
    ğŸ”’ Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº: 12
       â”œâ”€ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ…: 8
       â””â”€ Ğ ÑƒÑ‡Ğ½Ñ‹Ñ…: 4

    ğŸ“ˆ ĞŸĞ¾ severity:
       â€¢ Low: 28 (62%)
       â€¢ Medium: 12 (27%)
       â€¢ High: 4 (9%)
       â€¢ Critical: 1 (2%)

    ğŸ¯ Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ (Ğ¿Ğ¾ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸ÑĞ¼):
       â€¢ ĞĞ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¾ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¹: 3/15 (20%)
       â€¢ ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ñ‘Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹: 80%

    ğŸŒ Ğ“ĞµĞ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ Ğ½Ğ°Ñ€ÑƒÑˆĞ¸Ñ‚ĞµĞ»ĞµĞ¹:
       â€¢ RU: 25
       â€¢ UA: 8
       â€¢ DE: 5
       â€¢ Other: 7

[ ] Ğ¢Ğ¾Ğ¿ Ğ½Ğ°Ñ€ÑƒÑˆĞ¸Ñ‚ĞµĞ»ĞµĞ¹:
    ğŸ† Ğ¢Ğ¾Ğ¿-10 Ğ¿Ğ¾ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸ÑĞ¼ (30 Ğ´Ğ½ĞµĞ¹)

    1. @user1 - 5 Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹ (Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½)
    2. @user2 - 4 Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ (Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´Ñ‘Ğ½)
    3. @user3 - 3 Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ (Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³)
    ...
```

### 4.3 Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ²

```
[ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°:
    - CSV ÑĞ¾ Ğ²ÑĞµĞ¼Ğ¸ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ·Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´
    - Ğ¡Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ² PDF
    - JSON Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸
```

### 4.4 Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (Trust Score)

```python
class TrustScoreSystem:
    """
    Ğ”Ğ¾Ğ»Ğ³Ğ¾ÑÑ€Ğ¾Ñ‡Ğ½Ğ°Ñ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    """

    INITIAL_SCORE = 100
    MAX_SCORE = 150
    MIN_SCORE = 0

    SCORE_CHANGES = {
        'violation_low': -5,
        'violation_medium': -15,
        'violation_high': -30,
        'violation_critical': -50,
        'appeal_approved': +10,        # ĞĞ°ÑˆĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°
        'clean_week': +2,              # ĞĞµĞ´ĞµĞ»Ñ Ğ±ĞµĞ· Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹
        'clean_month': +10,            # ĞœĞµÑÑÑ† Ğ±ĞµĞ· Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹
        'long_time_customer': +20,     # > 6 Ğ¼ĞµÑÑÑ†ĞµĞ² ĞºĞ»Ğ¸ĞµĞ½Ñ‚
    }

    SCORE_EFFECTS = {
        (0, 20): {
            'action': 'permanent_block',
            'description': 'Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ñ€ÑƒÑ‡Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸',
        },
        (20, 40): {
            'action': 'reduce_hwid_limit',
            'modifier': -1,
            'description': 'Ğ¡Ğ½Ğ¸Ğ¶ĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²',
        },
        (40, 60): {
            'action': 'strict_monitoring',
            'description': 'Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ¸Ğ¹ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³',
        },
        (60, 80): {
            'action': 'standard',
            'description': 'Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼',
        },
        (80, 120): {
            'action': 'relaxed',
            'modifier': 0.8,  # ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ´Ğ»Ñ ÑĞºĞ¾Ñ€Ğ° Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹
            'description': 'Ğ”Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ',
        },
        (120, 151): {
            'action': 'trusted',
            'modifier': 0.6,
            'description': 'VIP Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ',
        },
    }
```

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 5: Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ

### 5.1 ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
remnawave-admin/
â”œâ”€â”€ src/                      # Telegram Ğ±Ğ¾Ñ‚ (ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹)
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ backend/              # FastAPI
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ v1/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ users.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ nodes.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ violations.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ websocket.py
â”‚   â”‚   â”‚   â””â”€â”€ deps.py       # Dependencies
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”‚   â”‚   â””â”€â”€ permissions.py
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ main.py
â”‚   â”‚   â””â”€â”€ requirements.txt
â”‚   â””â”€â”€ frontend/             # React + TypeScript
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ components/
â”‚       â”‚   â”‚   â”œâ”€â”€ common/
â”‚       â”‚   â”‚   â”œâ”€â”€ users/
â”‚       â”‚   â”‚   â”œâ”€â”€ violations/
â”‚       â”‚   â”‚   â””â”€â”€ analytics/
â”‚       â”‚   â”œâ”€â”€ pages/
â”‚       â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Users.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ UserDetail.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Violations.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ AntiAbuseCenter.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Analytics.tsx
â”‚       â”‚   â”‚   â””â”€â”€ Settings.tsx
â”‚       â”‚   â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ api/
â”‚       â”‚   â”œâ”€â”€ store/        # Zustand/Redux
â”‚       â”‚   â””â”€â”€ App.tsx
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ vite.config.ts
â””â”€â”€ docker-compose.yml
```

### 5.2 Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸

#### Dashboard
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Dashboard                              [ğŸ”” 3] [Admin â–¼]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1,847  â”‚ â”‚   124   â”‚ â”‚   12    â”‚ â”‚    5    â”‚ â”‚    3    â”‚   â”‚
â”‚  â”‚ Users   â”‚ â”‚ Online  â”‚ â”‚ Nodes   â”‚ â”‚ Blocked â”‚ â”‚ Alerts  â”‚   â”‚
â”‚  â”‚ Total   â”‚ â”‚   Now   â”‚ â”‚ Active  â”‚ â”‚  Today  â”‚ â”‚ Pending â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“ˆ Connections (24h)           â”‚ â”‚ ğŸš¨ Violations (7d)       â”‚â”‚
â”‚  â”‚                                â”‚ â”‚                          â”‚â”‚
â”‚  â”‚    120 â”€â”      â•­â”€â”€â•®            â”‚ â”‚  Low â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 62%     â”‚â”‚
â”‚  â”‚    100 â”€â”¤   â•­â”€â”€â•¯  â•°â”€â”€â•®        â”‚ â”‚  Med â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 27%     â”‚â”‚
â”‚  â”‚     80 â”€â”¤â•­â”€â”€â•¯        â•°â”€â”€â•®     â”‚ â”‚  High â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  9%     â”‚â”‚
â”‚  â”‚     60 â”€â”¼â•¯              â•°â”€    â”‚ â”‚  Crit â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2%     â”‚â”‚
â”‚  â”‚         00  06  12  18  24    â”‚ â”‚                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ”´ Live Activity                              [Filter â–¼]    â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ğŸŸ¢ 12:45:32  @john connected from 185.x.x.x (Moscow)       â”‚â”‚
â”‚  â”‚ âš ï¸ 12:44:15  Violation detected for @alice (score: 78)     â”‚â”‚
â”‚  â”‚ ğŸ”’ 12:42:08  @bob blocked (auto, 24h, device_limit)        â”‚â”‚
â”‚  â”‚ ğŸ”„ 12:40:55  Node DE-1 restarted by admin                  â”‚â”‚
â”‚  â”‚ ğŸŸ¢ 12:38:22  @charlie connected from 91.x.x.x (Berlin)     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Anti-Abuse Center
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›¡ Anti-Abuse Center                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Live Monitor] [Violations] [Blocks] [Appeals] [Settings]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ”´ Requires Attention (3)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âš ï¸ @suspicious_user                                         â”‚â”‚
â”‚  â”‚    Score: 72 | Confidence: 65% | IPs: 6 | Limit: 3          â”‚â”‚
â”‚  â”‚    Factors: geo_anomaly, profile_deviation                  â”‚â”‚
â”‚  â”‚    [ğŸ‘ Details] [âš ï¸ Warn] [ğŸ”’ Block] [âœ… Whitelist]          â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ğŸš¨ @another_user                                            â”‚â”‚
â”‚  â”‚    Score: 88 | Confidence: 82% | IPs: 8 | Limit: 2          â”‚â”‚
â”‚  â”‚    Factors: simultaneous_connections, multiple_countries    â”‚â”‚
â”‚  â”‚    [ğŸ‘ Details] [âš ï¸ Warn] [ğŸ”’ Block] [âœ… Whitelist]          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Š Active Connections Map                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    ğŸ—º World Map                              â”‚â”‚
â”‚  â”‚     [Visual map with dots for active connections]           â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Legend: ğŸŸ¢ Normal  ğŸŸ¡ Monitoring  ğŸ”´ Suspicious            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### User Detail (Ñ Anti-Abuse Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ User: @username                              [Edit] [Block] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“‹ Profile           â”‚  â”‚ ğŸ›¡ Anti-Abuse Status              â”‚â”‚
â”‚  â”‚                      â”‚  â”‚                                   â”‚â”‚
â”‚  â”‚ UUID: abc-123-...    â”‚  â”‚ Trust Score: 85/150 ğŸŸ¢            â”‚â”‚
â”‚  â”‚ Email: user@mail.com â”‚  â”‚ Status: Trusted User              â”‚â”‚
â”‚  â”‚ Telegram: @username  â”‚  â”‚                                   â”‚â”‚
â”‚  â”‚ Status: ğŸŸ¢ Active    â”‚  â”‚ Violations (30d): 1               â”‚â”‚
â”‚  â”‚ Created: 2025-06-15  â”‚  â”‚ Last violation: 15 days ago       â”‚â”‚
â”‚  â”‚ Expires: 2026-06-15  â”‚  â”‚ Current score: 12 (low risk)      â”‚â”‚
â”‚  â”‚                      â”‚  â”‚                                   â”‚â”‚
â”‚  â”‚ HWID Limit: 3        â”‚  â”‚ [ğŸ“Š Full History] [âš™ï¸ Settings]   â”‚â”‚
â”‚  â”‚ Traffic: 45.2 GB     â”‚  â”‚                                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“± Active Connections (2/3)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Device          â”‚ IP           â”‚ Location    â”‚ Since       â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Android/V2RayNG â”‚ 185.x.x.x    â”‚ Moscow, RU  â”‚ 2h ago      â”‚â”‚
â”‚  â”‚ iOS/Shadowrocketâ”‚ 185.x.x.y    â”‚ Moscow, RU  â”‚ 5h ago      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ˆ Connection History (7 days)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  IPs â”‚     â•­â”€â•®                                              â”‚â”‚
â”‚  â”‚   4  â”‚  â•­â”€â”€â•¯ â•°â”€â”€â•®     â•­â”€â”€â•®                                 â”‚â”‚
â”‚  â”‚   2  â”‚â”€â”€â•¯       â•°â”€â”€â”€â”€â”€â•¯  â•°â”€â”€                               â”‚â”‚
â”‚  â”‚      â”‚  Mon Tue Wed Thu Fri Sat Sun                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 API ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹ (Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğµ)

```
# Authentication
POST   /api/v1/auth/telegram           # Telegram Login Widget
POST   /api/v1/auth/refresh            # Refresh JWT
POST   /api/v1/auth/logout             # Logout

# Users
GET    /api/v1/users                   # List (paginated, filterable)
GET    /api/v1/users/:uuid             # Get user with anti-abuse data
PATCH  /api/v1/users/:uuid             # Update user
GET    /api/v1/users/:uuid/connections # Connection history
GET    /api/v1/users/:uuid/violations  # Violation history
GET    /api/v1/users/:uuid/trust-score # Trust score details
POST   /api/v1/users/:uuid/whitelist   # Add to whitelist

# Violations
GET    /api/v1/violations              # List violations
GET    /api/v1/violations/:id          # Violation details
POST   /api/v1/violations/:id/resolve  # Resolve (approve/reject)
GET    /api/v1/violations/pending      # Pending review

# Blocks
GET    /api/v1/blocks                  # Active blocks
GET    /api/v1/blocks/history          # Block history
POST   /api/v1/blocks                  # Manual block
DELETE /api/v1/blocks/:id              # Unblock
PATCH  /api/v1/blocks/:id              # Modify block (extend/reduce)

# Appeals
GET    /api/v1/appeals                 # List appeals
GET    /api/v1/appeals/:id             # Appeal details
POST   /api/v1/appeals/:id/decide      # Approve/reject appeal

# Analytics
GET    /api/v1/analytics/overview      # Dashboard stats
GET    /api/v1/analytics/violations    # Violation stats
GET    /api/v1/analytics/connections   # Connection stats
GET    /api/v1/analytics/geo           # Geographic distribution
GET    /api/v1/analytics/trends        # Trends over time
POST   /api/v1/analytics/export        # Export report

# Anti-Abuse Settings
GET    /api/v1/anti-abuse/settings     # Current settings
PATCH  /api/v1/anti-abuse/settings     # Update settings
GET    /api/v1/anti-abuse/whitelist    # Whitelist
POST   /api/v1/anti-abuse/whitelist    # Add to whitelist
DELETE /api/v1/anti-abuse/whitelist/:id# Remove from whitelist

# Real-time
WS     /api/v1/ws                      # WebSocket for live updates
```

---

## ğŸš€ Ğ¤Ğ°Ğ·Ğ° 6: ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ğ°Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### 6.1 Rules Engine

```
[ ] Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“œ Rule: High Traffic Alert                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  IF:                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [user.traffic_today] [>] [50 GB]                            â”‚â”‚
â”‚  â”‚                                           [+ Add Condition] â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  AND:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [user.subscription_type] [!=] [unlimited]                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  THEN:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Action: [Send notification â–¼]                               â”‚â”‚
â”‚  â”‚ Target: [Admin group â–¼]                                     â”‚â”‚
â”‚  â”‚ Message: "User {username} used {traffic} today"             â”‚â”‚
â”‚  â”‚                                           [+ Add Action]    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  [ğŸ’¾ Save Rule] [â–¶ï¸ Test Rule] [ğŸ—‘ Delete]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ ] ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»:
    - Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ traffic > X
    - ĞĞ²Ñ‚Ğ¾-Ğ¿Ñ€Ğ¾Ğ´Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ trusted users
    - ĞĞ²Ñ‚Ğ¾-Ğ±Ğ»Ğ¾Ğº Ğ¿Ñ€Ğ¸ score > 95
    - ĞÑ‚Ñ‡Ñ‘Ñ‚ Ğ¿Ñ€Ğ¸ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğµ
    - ĞĞ»ĞµÑ€Ñ‚ Ğ¿Ñ€Ğ¸ > N Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ÑÑ… Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ IP
```

### 6.2 Scheduled Tasks

```
[ ] ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡:
    - Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ¿Ğ¾ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸ÑĞ¼ (ÑƒÑ‚Ñ€Ğ¾Ğ¼)
    - Ğ•Ğ¶ĞµĞ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ²Ğ¾Ğ´ĞºĞ° Ğ´Ğ»Ñ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ°
    - ĞĞ²Ñ‚Ğ¾Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (> 90 Ğ´Ğ½ĞµĞ¹)
    - ĞŸĞµÑ€ĞµÑÑ‡Ñ‘Ñ‚ Trust Score (Ñ€Ğ°Ğ· Ğ² Ğ´ĞµĞ½ÑŒ)
    - Backup Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº (Ñ€Ğ°Ğ· Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ)
    - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ÑÑ‚ĞµĞºĞ°ÑÑ‰Ğ¸Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº (Ğ·Ğ° 3 Ğ´Ğ½Ñ)
```

### 6.3 Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

```
[ ] Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹:
    - Discord webhooks Ğ´Ğ»Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
    - Email (SMTP) Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²
    - Slack Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
    - Prometheus Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    - Grafana Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹
    - Sentry Ğ´Ğ»Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
```

---

## ğŸ“… Ğ”Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ°

### Ğ­Ñ‚Ğ°Ğ¿ 1: MVP Anti-Abuse (4-6 Ğ½ĞµĞ´ĞµĞ»ÑŒ)
```
ĞĞµĞ´ĞµĞ»Ñ 1-2:
â”œâ”€â”€ Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ IP
â”œâ”€â”€ ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğµ Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ)
â””â”€â”€ Webhook Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

ĞĞµĞ´ĞµĞ»Ñ 3-4:
â”œâ”€â”€ Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°
â”œâ”€â”€ Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼
â””â”€â”€ Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ² Telegram

ĞĞµĞ´ĞµĞ»Ñ 5-6:
â”œâ”€â”€ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°
â”œâ”€â”€ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ²
â””â”€â”€ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
```

### Ğ­Ñ‚Ğ°Ğ¿ 2: Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (4-6 Ğ½ĞµĞ´ĞµĞ»ÑŒ)
```
â”œâ”€â”€ GeoIP Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
â”œâ”€â”€ ASN ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
â”œâ”€â”€ ĞœĞ½Ğ¾Ğ³Ğ¾Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³
â”œâ”€â”€ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
â””â”€â”€ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ (Confidence)
```

### Ğ­Ñ‚Ğ°Ğ¿ 3: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°Ğ¼Ğ¸ Ğ¸ Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¸ (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)
```
â”œâ”€â”€ Ğ Ğ°Ğ·Ğ´ĞµĞ» Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ±Ğ¾Ñ‚Ğµ
â”œâ”€â”€ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¹ (Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²)
â”œâ”€â”€ Trust Score ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°
â””â”€â”€ Whitelist ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
```

### Ğ­Ñ‚Ğ°Ğ¿ 4: Ğ‘Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³ Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ñ‹ (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)
```
â”œâ”€â”€ Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ¾Ğ¼ Remnawave
â”œâ”€â”€ Ğ”Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ¿Ğ¾ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ğ¼
â”œâ”€â”€ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ (Ğ¿Ğ°ÑƒĞ·Ğ°/Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ)
â””â”€â”€ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Anti-Abuse Ğ¿Ğ¾ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ğ¼
```

### Ğ­Ñ‚Ğ°Ğ¿ 5: Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° (3-4 Ğ½ĞµĞ´ĞµĞ»Ğ¸)
```
â”œâ”€â”€ Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ² Telegram
â”œâ”€â”€ Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ² (CSV, PDF, JSON)
â”œâ”€â”€ Ğ¢Ğ¾Ğ¿ Ğ½Ğ°Ñ€ÑƒÑˆĞ¸Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹
â””â”€â”€ Ğ“ĞµĞ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
```

### Ğ­Ñ‚Ğ°Ğ¿ 6: Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (8-12 Ğ½ĞµĞ´ĞµĞ»ÑŒ)
```
â”œâ”€â”€ Backend API (FastAPI)
â”œâ”€â”€ Frontend (React + TypeScript)
â”œâ”€â”€ Dashboard, Users, Anti-Abuse Center
â”œâ”€â”€ Real-time WebSocket
â””â”€â”€ ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ (Telegram Login + JWT)
```

### Ğ­Ñ‚Ğ°Ğ¿ 7: ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (4-6 Ğ½ĞµĞ´ĞµĞ»ÑŒ)
```
â”œâ”€â”€ Rules Engine (Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€)
â”œâ”€â”€ Scheduled tasks
â”œâ”€â”€ Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ (Discord, Slack, Email)
â””â”€â”€ Prometheus/Grafana Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
```

---

## ğŸ—ƒï¸ ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ 0003: Anti-Abuse (Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ)

```sql
-- Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ user_connections
ALTER TABLE user_connections ADD COLUMN IF NOT EXISTS
    user_agent TEXT,
    device_fingerprint VARCHAR(64),
    country_code VARCHAR(2),
    country_name VARCHAR(100),
    city VARCHAR(100),
    region VARCHAR(100),
    latitude DECIMAL(9,6),
    longitude DECIMAL(9,6),
    timezone VARCHAR(50),
    asn INT,
    asn_org VARCHAR(200),
    connection_type VARCHAR(20),
    is_proxy BOOLEAN DEFAULT FALSE,
    is_vpn BOOLEAN DEFAULT FALSE,
    is_tor BOOLEAN DEFAULT FALSE;

CREATE INDEX idx_user_connections_geo ON user_connections(country_code, city);
CREATE INDEX idx_user_connections_asn ON user_connections(asn);

-- ĞĞ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ
CREATE TABLE violations (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,
    violation_type VARCHAR(50) NOT NULL,

    -- Ğ¡ĞºĞ¾Ñ€Ğ¸Ğ½Ğ³
    total_score DECIMAL(5,2) NOT NULL,
    confidence DECIMAL(3,2) NOT NULL,
    severity VARCHAR(20) NOT NULL,

    -- Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸
    hwid_limit INT NOT NULL,
    detected_ips INT NOT NULL,
    simultaneous_connections INT DEFAULT 0,

    -- Breakdown Ğ¿Ğ¾ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ°Ğ¼
    score_breakdown JSONB NOT NULL,
    /*
    {
        "temporal": {"score": 80, "reason": "simultaneous_connections"},
        "geo": {"score": 50, "countries": ["RU", "DE"]},
        "asn": {"score": 0, "type": "mobile"},
        "profile": {"score": 45, "deviation": "high"},
        "device": {"score": 40, "os_count": 3}
    }
    */

    -- IP Ğ°Ğ´Ñ€ĞµÑĞ° Ğ¸ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    ip_addresses JSONB NOT NULL,
    /*
    [
        {"ip": "185.x.x.x", "country": "RU", "city": "Moscow", "asn": "MTS"},
        {"ip": "91.x.x.x", "country": "DE", "city": "Berlin", "asn": "Hetzner"}
    ]
    */

    -- Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ
    action_taken VARCHAR(50),
    action_reason TEXT,

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    resolved_at TIMESTAMP WITH TIME ZONE,
    resolved_by BIGINT,
    resolution_type VARCHAR(50),  -- 'auto_expired', 'admin_approved', 'admin_rejected'
    resolution_notes TEXT
);

CREATE INDEX idx_violations_user ON violations(user_uuid);
CREATE INDEX idx_violations_created ON violations(created_at);
CREATE INDEX idx_violations_severity ON violations(severity);
CREATE INDEX idx_violations_unresolved ON violations(resolved_at) WHERE resolved_at IS NULL;

-- Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ (Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ)
CREATE TABLE temp_blocks (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,
    violation_id INT REFERENCES violations(id),

    -- Ğ¢Ğ¸Ğ¿ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
    block_type VARCHAR(50) NOT NULL,  -- 'soft_limit', 'temp_block', 'permanent'

    -- ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹
    reason VARCHAR(255) NOT NULL,
    violation_score DECIMAL(5,2),
    confidence DECIMAL(3,2),
    speed_limit_bytes BIGINT,  -- Ğ´Ğ»Ñ soft_limit

    -- Ğ’Ñ€ĞµĞ¼Ñ
    blocked_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    unblock_at TIMESTAMP WITH TIME ZONE,
    actual_unblock_at TIMESTAMP WITH TIME ZONE,

    -- ĞšÑ‚Ğ¾
    blocked_by VARCHAR(100) NOT NULL,  -- 'auto:high_confidence', 'admin:123456789'
    unblocked_by VARCHAR(100),

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    is_active BOOLEAN DEFAULT TRUE,

    -- ĞĞ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ñ
    appeal_id INT,

    -- Snapshot Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    metadata JSONB
);

CREATE INDEX idx_blocks_user ON temp_blocks(user_uuid);
CREATE INDEX idx_blocks_active ON temp_blocks(is_active) WHERE is_active = TRUE;
CREATE INDEX idx_blocks_unblock ON temp_blocks(unblock_at) WHERE is_active = TRUE;

-- Trust Score
CREATE TABLE user_trust_scores (
    id SERIAL PRIMARY KEY,
    user_uuid UUID UNIQUE NOT NULL,

    current_score INT NOT NULL DEFAULT 100,
    max_score INT NOT NULL DEFAULT 100,
    min_score INT NOT NULL DEFAULT 100,

    -- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
    score_history JSONB DEFAULT '[]',
    /*
    [
        {"date": "2026-01-15", "change": -15, "reason": "violation_medium", "new_score": 85},
        {"date": "2026-01-20", "change": +2, "reason": "clean_week", "new_score": 87}
    ]
    */

    -- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    total_violations INT DEFAULT 0,
    violations_30d INT DEFAULT 0,
    last_violation_at TIMESTAMP WITH TIME ZONE,
    clean_days INT DEFAULT 0,

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_trust_scores_score ON user_trust_scores(current_score);

-- ĞĞ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¸
CREATE TABLE appeals (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,
    block_id INT REFERENCES temp_blocks(id),
    violation_id INT REFERENCES violations(id),

    -- Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ
    reason_category VARCHAR(50),  -- 'traveling', 'vpn_usage', 'device_change', 'error', 'other'
    user_message TEXT NOT NULL,

    -- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
    status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'approved', 'rejected', 'auto_resolved'

    -- Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ
    decided_by BIGINT,
    decided_at TIMESTAMP WITH TIME ZONE,
    decision_notes TEXT,

    -- Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ
    action_taken VARCHAR(50),  -- 'unblock', 'reduce_block', 'whitelist', 'no_action'

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_appeals_status ON appeals(status);
CREATE INDEX idx_appeals_user ON appeals(user_uuid);

-- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Anti-Abuse
CREATE TABLE anti_abuse_settings (
    id SERIAL PRIMARY KEY,
    setting_key VARCHAR(100) UNIQUE NOT NULL,
    setting_value JSONB NOT NULL,
    description TEXT,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_by BIGINT
);

-- Whitelist
CREATE TABLE anti_abuse_whitelist (
    id SERIAL PRIMARY KEY,

    -- Ğ¢Ğ¸Ğ¿ whitelist
    whitelist_type VARCHAR(20) NOT NULL,  -- 'user', 'ip_range', 'asn'

    -- Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
    user_uuid UUID,
    ip_range CIDR,
    asn INT,

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    reason TEXT,
    added_by BIGINT NOT NULL,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE,  -- NULL = permanent

    CONSTRAINT whitelist_value_check CHECK (
        (whitelist_type = 'user' AND user_uuid IS NOT NULL) OR
        (whitelist_type = 'ip_range' AND ip_range IS NOT NULL) OR
        (whitelist_type = 'asn' AND asn IS NOT NULL)
    )
);

CREATE INDEX idx_whitelist_user ON anti_abuse_whitelist(user_uuid) WHERE user_uuid IS NOT NULL;
CREATE INDEX idx_whitelist_type ON anti_abuse_whitelist(whitelist_type);

-- ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (baseline)
CREATE TABLE user_behavior_profiles (
    id SERIAL PRIMARY KEY,
    user_uuid UUID UNIQUE NOT NULL,

    -- Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ
    typical_countries JSONB DEFAULT '[]',
    typical_cities JSONB DEFAULT '[]',
    typical_asns JSONB DEFAULT '[]',

    -- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    avg_daily_unique_ips DECIMAL(5,2),
    max_daily_unique_ips INT,
    avg_session_duration_minutes INT,
    typical_hours JSONB DEFAULT '[]',  -- [9, 10, 11, 18, 19, 20, 21, 22]

    -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    data_points INT DEFAULT 0,  -- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ 0004: Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ

```sql
-- Ğ Ğ¾Ğ»Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
CREATE TYPE admin_role AS ENUM ('super_admin', 'admin', 'moderator', 'viewer');

-- ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹
CREATE TABLE admins (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(100),
    first_name VARCHAR(100),
    role admin_role NOT NULL DEFAULT 'viewer',

    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by BIGINT,

    -- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
    settings JSONB DEFAULT '{}'
);

-- Ğ¡ĞµÑÑĞ¸Ğ¸
CREATE TABLE admin_sessions (
    id SERIAL PRIMARY KEY,
    admin_id INT REFERENCES admins(id),

    jwt_token_hash VARCHAR(64) UNIQUE,
    refresh_token_hash VARCHAR(64),

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
    last_activity_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

    ip_address INET,
    user_agent TEXT,

    is_active BOOLEAN DEFAULT TRUE
);

CREATE INDEX idx_sessions_active ON admin_sessions(is_active, expires_at);

-- ĞÑƒĞ´Ğ¸Ñ‚ Ğ»Ğ¾Ğ³
CREATE TABLE admin_audit_log (
    id SERIAL PRIMARY KEY,
    admin_id INT REFERENCES admins(id),

    action VARCHAR(100) NOT NULL,
    action_category VARCHAR(50),  -- 'user', 'violation', 'settings', 'block'

    target_type VARCHAR(50),
    target_id VARCHAR(100),

    details JSONB,
    ip_address INET,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_audit_admin ON admin_audit_log(admin_id);
CREATE INDEX idx_audit_created ON admin_audit_log(created_at);
CREATE INDEX idx_audit_action ON admin_audit_log(action_category, action);
```

---

## ğŸ“ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ)

```env
# ===========================================
# Anti-Abuse Configuration
# ===========================================

# ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
ANTI_ABUSE_ENABLED=true
ANTI_ABUSE_DETECTION_INTERVAL_SECONDS=60

# ĞŸĞ¾Ñ€Ğ¾Ğ³Ğ¸ ÑĞºĞ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
ANTI_ABUSE_THRESHOLD_MONITOR=30
ANTI_ABUSE_THRESHOLD_WARN=50
ANTI_ABUSE_THRESHOLD_SOFT_LIMIT=65
ANTI_ABUSE_THRESHOLD_TEMP_BLOCK=80
ANTI_ABUSE_THRESHOLD_HARD_BLOCK=95

# Ğ’ĞµÑĞ° Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¾Ğ²
ANTI_ABUSE_WEIGHT_TEMPORAL=0.25
ANTI_ABUSE_WEIGHT_GEO=0.25
ANTI_ABUSE_WEIGHT_ASN=0.15
ANTI_ABUSE_WEIGHT_PROFILE=0.20
ANTI_ABUSE_WEIGHT_DEVICE=0.15

# ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹
ANTI_ABUSE_MOBILE_CARRIER_MULTIPLIER=0.7
ANTI_ABUSE_DATACENTER_MULTIPLIER=1.5
ANTI_ABUSE_VPN_MULTIPLIER=1.2

# ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ°
ANTI_ABUSE_AUTO_ACTION_CONFIDENCE=0.85
ANTI_ABUSE_REQUIRE_HUMAN_CONFIDENCE=0.70

# ĞŸĞ°Ğ¼ÑÑ‚ÑŒ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹
ANTI_ABUSE_VIOLATION_MEMORY_DAYS=30
ANTI_ABUSE_CLEAN_RESET_DAYS=60

# Grace period Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
ANTI_ABUSE_NEW_USER_GRACE_DAYS=7

# ===========================================
# GeoIP Configuration
# ===========================================
GEOIP_ENABLED=true
GEOIP_PROVIDER=maxmind  # Ğ¸Ğ»Ğ¸ 'ipapi', 'ipinfo'
GEOIP_DATABASE_PATH=/data/GeoLite2-City.mmdb
GEOIP_API_KEY=your_api_key  # Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ²

# ===========================================
# Web Panel Configuration
# ===========================================
WEB_PANEL_ENABLED=true
WEB_PANEL_HOST=0.0.0.0
WEB_PANEL_PORT=8081
WEB_PANEL_SECRET_KEY=your-very-secret-key-change-me
WEB_PANEL_JWT_EXPIRY_HOURS=24
WEB_PANEL_JWT_REFRESH_DAYS=7
WEB_PANEL_CORS_ORIGINS=["http://localhost:3000", "https://admin.yourdomain.com"]

# ===========================================
# Notifications (Admin only)
# ===========================================
NOTIFICATIONS_TOPIC_VIOLATIONS=your_violations_topic_id
NOTIFICATIONS_ADMIN_ON_BLOCK=true
NOTIFICATIONS_ADMIN_ON_UNBLOCK=true
NOTIFICATIONS_ADMIN_ON_APPEAL=true

# Discord (optional)
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/...
DISCORD_NOTIFY_VIOLATIONS=true
DISCORD_NOTIFY_BLOCKS=true

# Email (optional)
SMTP_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your@email.com
SMTP_PASSWORD=your_password
SMTP_FROM=noreply@yourdomain.com
EMAIL_NOTIFY_CRITICAL=admin@yourdomain.com
```

---

## ğŸ”§ Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸

### Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼ ĞºĞ¾Ğ´Ğ¾Ğ¼

1. **services/api_client.py**
   - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ğ¾Ğ´ `get_online_users()` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹
   - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ğ¾Ğ´ `get_user_connections()` ĞµÑĞ»Ğ¸ API Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚

2. **services/webhook.py**
   - Ğ Ğ°ÑÑˆĞ¸Ñ€Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ `user.connected`, `user.disconnected`
   - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ IP Ğ¸ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹

3. **services/database.py**
   - ĞĞ¾Ğ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ violations, blocks, appeals
   - ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ user_behavior_profiles

4. **ĞĞ¾Ğ²Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹:**
   - `services/violation_detector.py` â€” Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
   - `services/auto_blocker.py` â€” ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°Ğ¼Ğ¸
   - `services/geoip.py` â€” Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ IP
   - `services/trust_score.py` â€” ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸
   - `services/appeal_handler.py` â€” Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ°Ğ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¹

5. **handlers/**
   - ĞĞ¾Ğ²Ñ‹Ğ¹ `handlers/antiabuse.py` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Anti-Abuse Ğ² Telegram
   - Ğ Ğ°ÑÑˆĞ¸Ñ€Ğ¸Ñ‚ÑŒ `handlers/users.py` â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Anti-Abuse Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ

### Ğ¡Ğ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¸ Feature Flags

```python
# config.py
class Settings:
    # Feature flags
    anti_abuse_enabled: bool = True
    anti_abuse_auto_block_enabled: bool = True
    geoip_enabled: bool = True
    web_panel_enabled: bool = False
    trust_score_enabled: bool = True
    appeals_enabled: bool = True  # ĞĞ¿ĞµĞ»Ğ»ÑÑ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²
```

Ğ’ÑĞµ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹:
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ feature flag Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸ĞµĞ¼
- Gracefully degradate ĞµÑĞ»Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°
- ĞĞµ Ğ²Ğ»Ğ¸ÑÑ‚ÑŒ Ğ½Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ°

---

## ğŸ“š Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

ĞŸÑ€Ğ¸ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ:
- `README.md` â€” Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹
- `CHANGELOG.md` â€” Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
- `docs/anti-abuse.md` â€” Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Anti-Abuse ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
- `docs/api.md` â€” OpenAPI/Swagger ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
- `docs/configuration.md` â€” Ğ²ÑĞµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
- `docs/troubleshooting.md` â€” Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼

---

*Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ Ğ²ĞµÑ€ÑĞ¸Ğ¸ 2.0. ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: 26.01.2026*
