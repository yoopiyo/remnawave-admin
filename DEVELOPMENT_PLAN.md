# üìã –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è Remnawave Admin Bot

> **–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 3.0
> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 26.01.2026
> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 27.01.2026
> **–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 1.5.x

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- Telegram –±–æ—Ç –Ω–∞ aiogram 3.12 —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é
- PostgreSQL –±–∞–∑–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ users, nodes, hosts, user_connections
- REST API –∫–ª–∏–µ–Ω—Ç –∫ Remnawave (~60 –º–µ—Ç–æ–¥–æ–≤)
- Webhook —Å–µ—Ä–≤–µ—Ä –¥–ª—è real-time —Å–æ–±—ã—Ç–∏–π
- HWID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ/–ª–∏–º–∏—Ç—ã)
- –¢–∞–±–ª–∏—Ü–∞ `user_connections` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è IP –∞–¥—Ä–µ—Å–æ–≤
- –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Ç–æ–ø–∏–∫–∞–º
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### ‚ùå –ß–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç:
- **–ú–µ—Ö–∞–Ω–∏–∑–º —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö —Å –Ω–æ–¥** (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
- –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ IP –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –£–º–Ω–æ–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –°–∏—Å—Ç–µ–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å —É—á—ë—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ü–µ–ª–∏

1. **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ real-time –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö
2. **Anti-Abuse —Å–∏—Å—Ç–µ–º–∞** ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —à–∞—Ä–∏–Ω–≥–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
3. **–ë–∏–ª–ª–∏–Ω–≥ –∏ —Ç–∞—Ä–∏—Ñ—ã** ‚Äî –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
4. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç—á—ë—Ç—ã
5. **–í–µ–±-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π UI –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
6. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî **–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω.

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Remnawave API

**Remnawave API –ù–ï –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:**
- ‚ùå –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚ùå IP –∞–¥—Ä–µ—Å–∞ —Ç–µ–∫—É—â–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- ‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚ùå –°–æ–±—ã—Ç–∏—è `user.connected` / `user.disconnected` —Å IP

**Remnawave API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:**
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞ (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é)
- ‚úÖ HWID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–Ω–æ —ç—Ç–æ –Ω–µ IP!)
- ‚úÖ Webhook —Å–æ–±—ã—Ç–∏—è (–Ω–æ –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- ‚úÖ `subscription_request_history` (–∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–æ–Ω—Ñ–∏–≥–∞, –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π)

### –í—ã–≤–æ–¥

**–ë–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Anti-Abuse —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –ù–ï –ë–£–î–ï–¢!**

–ù—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å –Ω–æ–¥ (—Å–µ—Ä–≤–µ—Ä–æ–≤ —Å Xray/Sing-box).

---

## üöÄ –§–∞–∑–∞ 0: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –¢–ï–ö–£–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê                     ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ   Remnawave Panel ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ API ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Admin Bot                ‚îÇ
‚îÇ         ‚îÇ                              ‚îÇ                    ‚îÇ
‚îÇ         ‚îÇ –∫–æ–Ω—Ñ–∏–≥–∏                      ‚îÇ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ         ‚îÇ
‚îÇ         ‚ñº                              ‚ñº                    ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ   ‚îÇ  Node 1     ‚îÇ                 ‚îÇ Telegram‚îÇ              ‚îÇ
‚îÇ   ‚îÇ  (Xray)     ‚îÇ  ‚Üê ??? ‚Üí        ‚îÇ  Admins ‚îÇ              ‚îÇ
‚îÇ   ‚îÇ             ‚îÇ  –ù–ï–¢ –î–ê–ù–ù–´–•     ‚îÇ         ‚îÇ              ‚îÇ
‚îÇ   ‚îÇ  IP: ?      ‚îÇ  –û –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø–• ‚îÇ         ‚îÇ              ‚îÇ
‚îÇ   ‚îÇ  Users: ?   ‚îÇ                 ‚îÇ         ‚îÇ              ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ   Xray –∑–Ω–∞–µ—Ç: –∫—Ç–æ –ø–æ–¥–∫–ª—é—á—ë–Ω, —Å –∫–∞–∫–æ–≥–æ IP, –∫–æ–≥–¥–∞            ‚îÇ
‚îÇ   –ù–æ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ Remnawave/Bot!             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç A: Node Agent (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –õ—ë–≥–∫–∏–π –∞–≥–µ–Ω—Ç –Ω–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥–µ, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Xray –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —Ü–µ–Ω—Ç—Ä.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –° NODE AGENT                   ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
‚îÇ                    ‚îÇ   Admin Bot      ‚îÇ                     ‚îÇ
‚îÇ                    ‚îÇ   + Collector    ‚îÇ                     ‚îÇ
‚îÇ                    ‚îÇ   (FastAPI)      ‚îÇ                     ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ≤‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
‚îÇ                             ‚îÇ                               ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ              ‚îÇ              ‚îÇ              ‚îÇ                ‚îÇ
‚îÇ         HTTP POST      HTTP POST      HTTP POST             ‚îÇ
‚îÇ     (connections)   (connections)  (connections)            ‚îÇ
‚îÇ              ‚îÇ              ‚îÇ              ‚îÇ                ‚îÇ
‚îÇ       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ       ‚îÇ   Node 1    ‚îÇ ‚îÇ  Node 2   ‚îÇ ‚îÇ  Node 3   ‚îÇ          ‚îÇ
‚îÇ       ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ ‚îÇ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ          ‚îÇ
‚îÇ       ‚îÇ ‚îÇ  Xray   ‚îÇ ‚îÇ ‚îÇ‚îÇ  Xray   ‚îÇ‚îÇ ‚îÇ‚îÇ  Xray   ‚îÇ‚îÇ          ‚îÇ
‚îÇ       ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ ‚îÇ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ          ‚îÇ
‚îÇ       ‚îÇ      ‚îÇlogs  ‚îÇ ‚îÇ     ‚îÇ     ‚îÇ ‚îÇ     ‚îÇ     ‚îÇ          ‚îÇ
‚îÇ       ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ ‚îÇ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ          ‚îÇ
‚îÇ       ‚îÇ ‚îÇ  Agent  ‚îÇ ‚îÇ ‚îÇ‚îÇ  Agent  ‚îÇ‚îÇ ‚îÇ‚îÇ  Agent  ‚îÇ‚îÇ          ‚îÇ
‚îÇ       ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ ‚îÇ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ          ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Agent —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
```python
# remnawave-node-agent (–æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç)

class NodeAgent:
    """
    –õ—ë–≥–∫–∏–π –∞–≥–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å Xray
    """

    def __init__(self, config):
        self.node_uuid = config.node_uuid
        self.collector_url = config.collector_url  # URL Admin Bot
        self.auth_token = config.auth_token

    async def collect_connections(self) -> List[Connection]:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏–∑ Xray

        –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
        1. Xray Stats API (gRPC) - –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω
        2. –ü–∞—Ä—Å–∏–Ω–≥ access.log –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        3. Xray API —á–µ—Ä–µ–∑ HTTP (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–∫—Å–∏)
        """
        # –í–∞—Ä–∏–∞–Ω—Ç 1: Xray gRPC Stats API
        connections = await self.xray_stats_api.query_stats()

        # –í–∞—Ä–∏–∞–Ω—Ç 2: Tail access.log
        # Format: 2026/01/27 12:00:00 [Info] [user@email] 1.2.3.4:12345 accepted
        connections = await self.parse_access_log()

        return connections

    async def send_to_collector(self, connections: List[Connection]):
        """
        –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π collector
        """
        await self.http_client.post(
            f"{self.collector_url}/api/v1/connections/batch",
            json={
                "node_uuid": self.node_uuid,
                "timestamp": datetime.utcnow().isoformat(),
                "connections": [c.dict() for c in connections],
            },
            headers={"Authorization": f"Bearer {self.auth_token}"}
        )

    async def run(self):
        """
        –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª: —Å–æ–±–∏—Ä–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥
        """
        while True:
            connections = await self.collect_connections()
            await self.send_to_collector(connections)
            await asyncio.sleep(self.interval_seconds)  # 10-30 —Å–µ–∫
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ Real-time –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Remnawave API
- ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –ª—é–±—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–¥—É
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –Ω–æ–¥—ã
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

#### –í–∞—Ä–∏–∞–Ω—Ç B: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Remnawave API

**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–∂–¥–∞—Ç—å—Å—è/–∑–∞–ø—Ä–æ—Å–∏—Ç—å —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Remnawave –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

**–ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç Remnawave:**
```
GET /api/connections/active
Response: {
    "connections": [
        {
            "user_uuid": "xxx",
            "node_uuid": "yyy",
            "ip_address": "1.2.3.4",
            "connected_at": "2026-01-27T12:00:00Z",
            "protocol": "vless",
            "user_agent": "..."
        },
        ...
    ]
}

# –ò–ª–∏ webhook —Å–æ–±—ã—Ç–∏—è:
- user.connection.opened {user_uuid, node_uuid, ip_address, ...}
- user.connection.closed {user_uuid, node_uuid, duration, bytes_transferred, ...}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞–≥–µ–Ω—Ç
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Remnawave

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç roadmap Remnawave
- ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Å—Ä–æ–∫–∏
- ‚ùå –í–æ–∑–º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

---

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤ Xray —á–µ—Ä–µ–∑ SSH –∏–ª–∏ shared volume.

```python
class LogParser:
    """
    –ü–∞—Ä—Å–∏–Ω–≥ access.log Xray –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
    """

    # –§–æ—Ä–º–∞—Ç –ª–æ–≥–∞ Xray (–ø—Ä–∏–º–µ—Ä):
    # 2026/01/27 12:00:00 [Info] app/proxyman/inbound: [user@email] 1.2.3.4:12345 accepted tcp:example.com:443

    LOG_PATTERN = re.compile(
        r'(\d{4}/\d{2}/\d{2} \d{2}:\d{2}:\d{2}).*?\[(\S+?@\S+?)\].*?(\d+\.\d+\.\d+\.\d+):(\d+)\s+accepted'
    )

    async def parse_log_line(self, line: str) -> Optional[Connection]:
        match = self.LOG_PATTERN.match(line)
        if match:
            timestamp, user_email, ip, port = match.groups()
            return Connection(
                user_email=user_email,
                ip_address=ip,
                connected_at=parse_timestamp(timestamp),
            )
        return None
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ë—ã—Å—Ç—Ä–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Xray

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –Ω–æ–¥
- ‚ùå –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ disconnect (—Ç–æ–ª—å–∫–æ connect)
- ‚ùå –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –±–æ–ª—å—à–∏—Ö –ª–æ–≥–æ–≤
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –ª–æ–≥–æ–≤

---

#### –í–∞—Ä–∏–∞–Ω—Ç D: Xray Stats API –Ω–∞–ø—Ä—è–º—É—é

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ Stats API Xray —á–µ—Ä–µ–∑ gRPC.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. –í–∫–ª—é—á–∏—Ç—å stats –≤ –∫–æ–Ω—Ñ–∏–≥–µ Xray:
```json
{
    "stats": {},
    "policy": {
        "levels": {
            "0": {
                "statsUserUplink": true,
                "statsUserDownlink": true
            }
        }
    },
    "api": {
        "tag": "api",
        "services": ["StatsService"]
    }
}
```

2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ gRPC:
```python
import grpc
from xray_api import stats_pb2, stats_pb2_grpc

async def get_xray_stats(node_address: str):
    channel = grpc.aio.insecure_channel(f"{node_address}:10085")
    stub = stats_pb2_grpc.StatsServiceStub(channel)

    # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    request = stats_pb2.QueryStatsRequest(pattern="user>>>", reset=False)
    response = await stub.QueryStats(request)

    for stat in response.stat:
        # stat.name = "user>>>email@example.com>>>traffic>>>uplink"
        # stat.value = bytes transferred
        ...
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API Xray
- ‚úÖ –¢–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç—Ä–∞—Ñ–∏–∫–µ

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –¢–æ–ª—å–∫–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (uplink/downlink)
- ‚ùå **–ù–ï–¢ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± IP –∞–¥—Ä–µ—Å–∞—Ö!**
- ‚ùå –ù–µ—Ç real-time —Å–æ–±—ã—Ç–∏–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –í–∞—Ä–∏–∞–Ω—Ç A (Node Agent) + –∑–∞–ø—Ä–æ—Å –Ω–∞ –í–∞—Ä–∏–∞–Ω—Ç B**

1. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ:** –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å Node Agent –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:** –ó–∞–ø—Ä–æ—Å–∏—Ç—å —É Remnawave —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ API
3. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:** –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞

---

### –ó–∞–¥–∞—á–∏ –§–∞–∑—ã 0

```
[ ] –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: –∫–∞–∫ Xray –ª–æ–≥–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    - –§–æ—Ä–º–∞—Ç—ã access.log
    - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Stats API
    - –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

[ ] –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Node Agent (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
    - –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
    - –ü–∞—Ä—Å–µ—Ä –ª–æ–≥–æ–≤ Xray
    - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    - Docker –æ–±—Ä–∞–∑ –¥–ª—è –¥–µ–ø–ª–æ—è

[ ] Collector API –≤ Admin Bot
    - Endpoint POST /api/v1/connections/batch
    - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤ (—Ç–æ–∫–µ–Ω—ã)
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    - –ó–∞–ø–∏—Å—å –≤ user_connections

[ ] –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏
    - –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
    - –°–∂–∞—Ç–∏–µ (gzip –¥–ª—è batch)
    - Retry –ª–æ–≥–∏–∫–∞
    - Heartbeat –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–∏

[ ] –î–µ–ø–ª–æ–π –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é –Ω–æ–¥—É
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
    - –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Node Agent

```
remnawave-node-agent/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Entry point
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ collectors/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py          # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xray_log.py      # –ü–∞—Ä—Å–µ—Ä access.log
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xray_stats.py    # gRPC Stats API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ singbox.py       # –î–ª—è Sing-box (–±—É–¥—É—â–µ–µ)
‚îÇ   ‚îú‚îÄ‚îÄ sender.py            # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ models.py            # Pydantic –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

### Collector API (–≤ Admin Bot)

```python
# src/services/collector.py

from fastapi import APIRouter, Depends, HTTPException
from pydantic import BaseModel
from typing import List
from datetime import datetime

router = APIRouter(prefix="/api/v1/connections", tags=["collector"])

class ConnectionReport(BaseModel):
    user_email: str
    ip_address: str
    node_uuid: str
    connected_at: datetime
    disconnected_at: Optional[datetime] = None
    bytes_sent: int = 0
    bytes_received: int = 0

class BatchReport(BaseModel):
    node_uuid: str
    timestamp: datetime
    connections: List[ConnectionReport]

@router.post("/batch")
async def receive_connections(
    report: BatchReport,
    agent_token: str = Depends(verify_agent_token),
    db: Database = Depends(get_db),
):
    """
    –ü—Ä–∏—ë–º –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö –æ—Ç Node Agent
    """
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ node_uuid —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–∫–µ–Ω—É
    if not await verify_node_token(report.node_uuid, agent_token):
        raise HTTPException(403, "Invalid token for this node")

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –ë–î
    for conn in report.connections:
        await db.upsert_connection(
            user_email=conn.user_email,
            ip_address=conn.ip_address,
            node_uuid=report.node_uuid,
            connected_at=conn.connected_at,
            disconnected_at=conn.disconnected_at,
        )

    # –¢—Ä–∏–≥–≥–µ—Ä–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É Anti-Abuse –¥–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    user_emails = set(c.user_email for c in report.connections)
    for email in user_emails:
        await violation_detector.check_user(email)

    return {"status": "ok", "processed": len(report.connections)}
```

---

## üöÄ –§–∞–∑–∞ 1: Anti-Abuse —Å–∏—Å—Ç–µ–º–∞ (–ë–∞–∑–æ–≤–∞—è)

> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:** –¢—Ä–µ–±—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 0 (—Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å –Ω–æ–¥)

### 1.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ IP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–¶–µ–ª—å:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ó–∞–¥–∞—á–∏:**

```
[ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Node Agent
    - –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ö–æ–¥—è—â–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö
    - –ó–∞–ø–∏—Å—å –≤ user_connections —Å geo-–¥–∞–Ω–Ω—ã–º–∏
    - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ disconnect —Å–æ–±—ã—Ç–∏–π

[ ] –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å ConnectionMonitor
    - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ –≤—Å–µ—Ö –Ω–æ–¥
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (connected, not disconnected)
    - –ü–æ–¥—Å—á—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP –∑–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ

[ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ database.py:
    - get_active_connections(user_uuid) -> List[Connection]
    - get_unique_ips_in_window(user_uuid, window_minutes) -> int
    - get_simultaneous_connections(user_uuid) -> int
    - get_connection_history(user_uuid, days) -> List[Connection]
```

| –°–∏—Ç—É–∞—Ü–∏—è | IP –º–µ–Ω—è–µ—Ç—Å—è? | –≠—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ? |
|----------|--------------|----------------|
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∏–ª—Å—è —Å WiFi –Ω–∞ 4G | –î–∞ | ‚ùå –ù–µ—Ç |
| –ú–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (CGNAT, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π IP) | –î–∞, —á–∞—Å—Ç–æ | ‚ùå –ù–µ—Ç |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ø–æ–µ–∑–¥–∫–µ (—Ä–∞–∑–Ω—ã–µ –≥–æ—Ä–æ–¥–∞) | –î–∞ | ‚ùå –ù–µ—Ç |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–¥–∞–ª –∞–∫–∫–∞—É–Ω—Ç –¥—Ä—É–∑—å—è–º | –î–∞ | ‚úÖ –î–∞ |
| –û–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ —Å VPN (—Ä–∞–∑–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã) | –î–∞ | ‚ùå –ù–µ—Ç |
| –ü—Ä–æ–¥–∞–∂–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–∞ —Ñ–æ—Ä—É–º–µ | –î–∞ | ‚úÖ –î–∞ |

### –ú–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑

**–¶–µ–ª—å:** –û—Ç–ª–∏—á–∞—Ç—å –ª–µ–≥–∏—Ç–∏–º–Ω—É—é —Å–º–µ–Ω—É IP –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —à–∞—Ä–∏–Ω–≥–∞

```
[ ] –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å IntelligentViolationDetector (services/violation_detector.py)
```

#### –§–∞–∫—Ç–æ—Ä 1: –í—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω

```python
class TemporalAnalyzer:
    """
    –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å–º–µ–Ω—ã IP
    """

    def analyze(self, connections: List[Connection]) -> TemporalScore:
        # –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É IP (< 1 –º–∏–Ω—É—Ç—ã) = –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ
        # –ù–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ IP –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –¥–∞–ª–µ–∫–∏

        # –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è —Å–º–µ–Ω–∞ IP –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è = –Ω–æ—Ä–º–∞–ª—å–Ω–æ

        # –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ä–∞–∑–Ω—ã—Ö IP = –æ—á–µ–Ω—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ
        pass

# –ü—Ä–∏–º–µ—Ä—ã:
# ‚úÖ OK: IP1 (09:00-12:00) ‚Üí IP2 (12:05-18:00) ‚Üí IP1 (18:30-23:00)
#    –ß–µ–ª–æ–≤–µ–∫ —É—à—ë–ª –∏–∑ –¥–æ–º–∞, –≤–µ—Ä–Ω—É–ª—Å—è
#
# ‚ö†Ô∏è SUSPICIOUS: IP1 (09:00-09:01) ‚Üí IP2 (09:02-09:03) ‚Üí IP3 (09:04-...)
#    –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
#
# üö® VIOLATION: IP1 –∞–∫—Ç–∏–≤–µ–Ω 09:00-12:00 –ò IP2 –∞–∫—Ç–∏–≤–µ–Ω 09:30-11:00
#    –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è = —Ç–æ—á–Ω–æ —Ä–∞–∑–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
```

**–ü—Ä–∞–≤–∏–ª–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:**

| –ü–∞—Ç—Ç–µ—Ä–Ω | –°–∫–æ—Ä | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|---------|------|---------------|
| –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ IP (gap > 5 –º–∏–Ω) | 0 | –ù–æ—Ä–º–∞–ª—å–Ω–æ |
| –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ IP (gap < 1 –º–∏–Ω), –±–ª–∏–∑–∫–∏–µ –≥–µ–æ | +10 | –í–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ç–∏ |
| –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ IP, –¥–∞–ª—ë–∫–∏–µ –≥–µ–æ | +40 | –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ |
| **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** | +80 | –ü–æ—á—Ç–∏ —Ç–æ—á–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ |
| –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è > 3 IP | +100 | –¢–æ—á–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ |

#### –§–∞–∫—Ç–æ—Ä 2: –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

```python
class GeoAnalyzer:
    """
    –ê–Ω–∞–ª–∏–∑ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IP
    """

    def analyze(self, ip_addresses: List[IPMetadata]) -> GeoScore:
        # –í—Å–µ IP –∏–∑ –æ–¥–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ = –Ω–æ—Ä–º–∞–ª—å–Ω–æ
        # IP –∏–∑ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã, —Ä–∞–∑–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ = –≤–æ–∑–º–æ–∂–Ω–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ
        # IP –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ = –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ
        # "Impossible travel" = —Ç–æ—á–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ
        pass

# –ü—Ä–∏–º–µ—Ä—ã:
# ‚úÖ OK: –ú–æ—Å–∫–≤–∞ ‚Üí –ú–æ—Å–∫–≤–∞ ‚Üí –ú–æ—Å–∫–≤–∞ (—Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã)
# ‚úÖ OK: –ú–æ—Å–∫–≤–∞ (—É—Ç—Ä–æ) ‚Üí –°–ü–± (–≤–µ—á–µ—Ä) - –ø–æ–µ–∑–¥ 4 —á–∞—Å–∞, —Ä–µ–∞–ª—å–Ω–æ
# ‚ö†Ô∏è SUSPICIOUS: –ú–æ—Å–∫–≤–∞ ‚Üí –ë–µ—Ä–ª–∏–Ω –∑–∞ 1 —á–∞—Å (–Ω–µ—Ä–µ–∞–ª—å–Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏)
# üö® VIOLATION: –ú–æ—Å–∫–≤–∞ –ò –ë–µ—Ä–ª–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
```

**–ü—Ä–∞–≤–∏–ª–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:**

| –ü–∞—Ç—Ç–µ—Ä–Ω | –°–∫–æ—Ä | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|---------|------|---------------|
| –í—Å–µ IP –∏–∑ –æ–¥–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ | 0 | –ù–æ—Ä–º–∞–ª—å–Ω–æ |
| IP –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã | +5 | –ù–æ—Ä–º–∞–ª—å–Ω–æ (–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ/–∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞) |
| IP –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ | +15 | –í–æ–∑–º–æ–∂–Ω–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ |
| IP –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω, –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –≤—Ä–µ–º—è | +50 | Impossible travel |
| IP –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ | +90 | –¢–æ—á–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ |

**–¢–∞–±–ª–∏—Ü–∞ "—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏" –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è:**
```python
TRAVEL_SPEEDS = {
    'same_city': 50,      # –∫–º/—á (—Ç–∞–∫—Å–∏/–º–µ—Ç—Ä–æ)
    'same_country': 200,  # –∫–º/—á (–ø–æ–µ–∑–¥/–º–∞—à–∏–Ω–∞)
    'international': 800, # –∫–º/—á (—Å–∞–º–æ–ª—ë—Ç)
}

def is_travel_realistic(loc1, loc2, time_diff_hours):
    distance = haversine(loc1, loc2)
    max_distance = TRAVEL_SPEEDS['international'] * time_diff_hours
    return distance <= max_distance
```

#### –§–∞–∫—Ç–æ—Ä 3: –¢–∏–ø –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (ASN –∞–Ω–∞–ª–∏–∑)

```python
class ASNAnalyzer:
    """
    –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
    """

    # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è ASN
    ASN_TYPES = {
        'mobile': ['MTS', 'Beeline', 'MegaFon', 'Tele2', 'Yota', ...],
        'residential': ['Rostelecom', 'ER-Telecom', 'TTK', ...],
        'datacenter': ['DigitalOcean', 'AWS', 'Hetzner', 'OVH', ...],
        'vpn': ['NordVPN', 'ExpressVPN', 'Mullvad', ...],
    }

    def analyze(self, ip_metadata: List[IPMetadata]) -> ASNScore:
        # –ú–æ–±–∏–ª—å–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä = –æ–∂–∏–¥–∞–µ–º —á–∞—Å—Ç—É—é —Å–º–µ–Ω—É IP
        # –î–æ–º–∞—à–Ω–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä = —Ä–µ–¥–∫–∞—è —Å–º–µ–Ω–∞ IP
        # –î–∞—Ç–∞—Ü–µ–Ω—Ç—Ä/VPN = –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–µ–≥–∏—Ç–∏–º–Ω–æ, –Ω–æ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ
        pass
```

**–ü—Ä–∞–≤–∏–ª–∞ ASN –∞–Ω–∞–ª–∏–∑–∞:**

| –¢–∏–ø –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ | –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–∫–æ—Ä–∞ |
|----------------|---------------------|-------------------|
| Mobile carrier | –ß–∞—Å—Ç–∞—è —Å–º–µ–Ω–∞ IP, CGNAT | √ó0.5 (—Å–Ω–∏–∂–∞–µ–º –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å) |
| Residential ISP | –†–µ–¥–∫–∞—è —Å–º–µ–Ω–∞ IP | √ó1.0 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π) |
| Datacenter | –ù–µ —Ç–∏–ø–∏—á–Ω–æ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | √ó1.5 |
| Known VPN | –ú–æ–∂–µ—Ç –±—ã—Ç—å –ª–µ–≥–∏—Ç–∏–º–Ω–æ | √ó1.2 |
| Tor exit node | –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ | √ó2.0 |

#### –§–∞–∫—Ç–æ—Ä 4: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
class UserProfileAnalyzer:
    """
    –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–±—ã—á–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """

    def build_baseline(self, user_uuid: str, days: int = 30) -> UserBaseline:
        """
        –°—Ç—Ä–æ–∏–º "–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π" –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        """
        return UserBaseline(
            typical_countries=['RU'],
            typical_cities=['Moscow', 'Saint Petersburg'],
            typical_asns=['MTS', 'Beeline'],
            avg_daily_unique_ips=2.3,
            max_daily_unique_ips=5,
            typical_connection_hours=[9, 10, 11, 18, 19, 20, 21, 22],
            avg_session_duration_minutes=45,
        )

    def analyze(self, current_behavior, baseline) -> ProfileScore:
        # –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ = –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ
        # –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ = –∞–¥–∞–ø—Ç–∞—Ü–∏—è baseline
        pass
```

**–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:**

| –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç baseline | –°–∫–æ—Ä | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|------------------------|------|---------------|
| –í –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã | 0 | –û–±—ã—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ |
| Unique IPs > avg √ó 1.5 | +15 | –ù–µ–±–æ–ª—å—à–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| Unique IPs > avg √ó 2 | +30 | –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| Unique IPs > max –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è | +45 | –ê–Ω–æ–º–∞–ª–∏—è |
| –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∞ (–ø–µ—Ä–≤—ã–π —Ä–∞–∑) | +20 | –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è |
| –ù–æ–≤—ã–π —Ç–∏–ø –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ | +10 | –í–æ–∑–º–æ–∂–Ω–æ —Å–º–µ–Ω–∏–ª –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ |

#### –§–∞–∫—Ç–æ—Ä 5: –ü–∞—Ç—Ç–µ—Ä–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Device Fingerprinting)

```python
class DeviceFingerprintAnalyzer:
    """
    –ê–Ω–∞–ª–∏–∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    """

    def extract_fingerprint(self, connection: Connection) -> DeviceFingerprint:
        # –ò–∑ User-Agent –∏ –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        return DeviceFingerprint(
            os_family='Android',
            os_version='13',
            client_type='V2RayNG',
            client_version='1.8.5',
            screen_resolution=None,  # –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
            timezone=None,           # –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
        )

    def analyze(self, fingerprints: List[DeviceFingerprint]) -> DeviceScore:
        # –†–∞–∑–Ω—ã–µ –û–° –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ = —Ç–æ—á–Ω–æ —Ä–∞–∑–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        # –û–¥–∏–Ω fingerprint, –Ω–æ —Ä–∞–∑–Ω—ã–µ IP = –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫, —Ä–∞–∑–Ω—ã–µ —Å–µ—Ç–∏
        pass
```

**–ü—Ä–∞–≤–∏–ª–∞ –∞–Ω–∞–ª–∏–∑–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:**

| –ü–∞—Ç—Ç–µ—Ä–Ω | –°–∫–æ—Ä | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|---------|------|---------------|
| –û–¥–∏–Ω fingerprint, —Ä–∞–∑–Ω—ã–µ IP | 0 | –û–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫, —Ä–∞–∑–Ω—ã–µ —Å–µ—Ç–∏ |
| –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ | +10 | –í–æ–∑–º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| –†–∞–∑–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã (V2RayNG + Shadowrocket) | +25 | –†–∞–∑–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ |
| –†–∞–∑–Ω—ã–µ –û–° (Android + iOS + Windows) | +40 | –¢–æ—á–Ω–æ —Ä–∞–∑–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ |
| > 3 —Ä–∞–∑–Ω—ã—Ö fingerprint –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ | +60 | –ú–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ |

### –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–∫–æ—Ä–∏–Ω–≥ –Ω–∞—Ä—É—à–µ–Ω–∏–π

```python
class ViolationScorer:
    """
    –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤ –µ–¥–∏–Ω—ã–π —Å–∫–æ—Ä
    """

    WEIGHTS = {
        'temporal': 0.25,      # –í—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω
        'geo': 0.25,           # –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
        'asn': 0.15,           # –¢–∏–ø –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
        'profile': 0.20,       # –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –ø—Ä–æ—Ñ–∏–ª—è
        'device': 0.15,        # Fingerprint —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    }

    THRESHOLDS = {
        'no_action': 30,       # < 30: –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        'monitor': 50,         # 30-50: —É—Å–∏–ª–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        'warn': 65,            # 50-65: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        'soft_block': 80,      # 65-80: –º—è–≥–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏)
        'temp_block': 90,      # 80-90: –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
        'hard_block': 95,      # > 95: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ + —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    }

    def calculate_score(self, user_uuid: str) -> ViolationScore:
        temporal = self.temporal_analyzer.analyze(...)
        geo = self.geo_analyzer.analyze(...)
        asn = self.asn_analyzer.analyze(...)
        profile = self.profile_analyzer.analyze(...)
        device = self.device_analyzer.analyze(...)

        # –í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞
        raw_score = (
            temporal.score * self.WEIGHTS['temporal'] +
            geo.score * self.WEIGHTS['geo'] +
            asn.score * self.WEIGHTS['asn'] +
            profile.score * self.WEIGHTS['profile'] +
            device.score * self.WEIGHTS['device']
        )

        # –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
        if asn.is_mobile_carrier:
            raw_score *= 0.7  # –°–Ω–∏–∂–∞–µ–º –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö

        if self.has_simultaneous_connections(user_uuid):
            raw_score = max(raw_score, 85)  # –ú–∏–Ω–∏–º—É–º 85 –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö

        return ViolationScore(
            total=raw_score,
            breakdown={
                'temporal': temporal,
                'geo': geo,
                'asn': asn,
                'profile': profile,
                'device': device,
            },
            recommended_action=self.get_action(raw_score),
            confidence=self.calculate_confidence(...),
        )
```

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### –ü—Ä–∏–º–µ—Ä 1: –õ–µ–≥–∏—Ç–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –º–æ–±–∏–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @ivan
HWID –ª–∏–º–∏—Ç: 3
–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP –∑–∞ –¥–µ–Ω—å: 8

–ê–Ω–∞–ª–∏–∑:
- Temporal: +5 (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞, –Ω–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö)
- Geo: 0 (–≤—Å–µ IP –∏–∑ –ú–æ—Å–∫–≤—ã)
- ASN: √ó0.5 –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–ú–¢–° - –º–æ–±–∏–ª—å–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä)
- Profile: +10 (–æ–±—ã—á–Ω–æ 5-6 IP, —Å–µ–≥–æ–¥–Ω—è 8)
- Device: 0 (–æ–¥–∏–Ω fingerprint - Android/V2RayNG)

–ò—Ç–æ–≥–æ: (5 + 0 + 0 + 10 + 0) √ó 0.7 = 10.5

–î–µ–π—Å—Ç–≤–∏–µ: ‚úÖ –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å (< 30)
```

#### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π —à–∞—Ä–∏–Ω–≥
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @alice
HWID –ª–∏–º–∏—Ç: 2
–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP –∑–∞ –¥–µ–Ω—å: 6

–ê–Ω–∞–ª–∏–∑:
- Temporal: +80 (3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!)
- Geo: +50 (–ú–æ—Å–∫–≤–∞ + –ë–µ—Ä–ª–∏–Ω + –ö–∏–µ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- ASN: √ó1.0 (residential ISPs)
- Profile: +45 (–æ–±—ã—á–Ω–æ 1-2 IP, –∞–Ω–æ–º–∞–ª–∏—è)
- Device: +40 (Android + iOS + Windows –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

–ò—Ç–æ–≥–æ: (80√ó0.25 + 50√ó0.25 + 0 + 45√ó0.20 + 40√ó0.15) = 20 + 12.5 + 9 + 6 = 47.5
+ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ = max(47.5, 85) = 85

–î–µ–π—Å—Ç–≤–∏–µ: üîí –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
```

#### –ü—Ä–∏–º–µ—Ä 3: –ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @traveler
HWID –ª–∏–º–∏—Ç: 3
–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP –∑–∞ –Ω–µ–¥–µ–ª—é: 15

–ê–Ω–∞–ª–∏–∑:
- Temporal: +5 (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞, 1-2 IP –≤ –¥–µ–Ω—å)
- Geo: +15 (–ú–æ—Å–∫–≤–∞ ‚Üí –°—Ç–∞–º–±—É–ª ‚Üí –î—É–±–∞–π, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã)
- ASN: √ó1.0 (—Ä–∞–∑–Ω—ã–µ residential)
- Profile: +20 (–Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω—ã, –Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)
- Device: 0 (–æ–¥–∏–Ω fingerprint)

–ò—Ç–æ–≥–æ: (5 + 15 + 0 + 20 + 0) = 40

–î–µ–π—Å—Ç–≤–∏–µ: üëÅ –£—Å–∏–ª–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
```

### –°–∏—Å—Ç–µ–º–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (Confidence)

```python
class ConfidenceCalculator:
    """
    –û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ä–µ—à–µ–Ω–∏–∏
    """

    def calculate(self, violation_score: ViolationScore) -> Confidence:
        factors = []

        # –í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
        if violation_score.has_simultaneous_connections:
            factors.append(('simultaneous', 0.95))

        if violation_score.device.different_os_count >= 3:
            factors.append(('multiple_os', 0.90))

        # –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
        if violation_score.geo.impossible_travel:
            factors.append(('impossible_travel', 0.85))

        # –ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (—Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞)
        if violation_score.total > 70 and not factors:
            factors.append(('score_only', 0.60))

        return Confidence(
            level=max(f[1] for f in factors) if factors else 0.5,
            factors=factors,
            requires_human_review=any(f[1] < 0.75 for f in factors),
        )
```

**–£—Ä–æ–≤–Ω–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:**

| Confidence | –ó–Ω–∞—á–µ–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|------------|----------|----------|
| > 0.90 | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ |
| 0.75 - 0.90 | –í—ã—Å–æ–∫–∞—è | –ê–≤—Ç–æ-–¥–µ–π—Å—Ç–≤–∏–µ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É |
| 0.60 - 0.75 | –°—Ä–µ–¥–Ω—è—è | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É, –∂–¥—ë–º —Ä–µ—à–µ–Ω–∏—è |
| < 0.60 | –ù–∏–∑–∫–∞—è | –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –Ω—É–∂–µ–Ω —á–µ–ª–æ–≤–µ–∫ |

---

## üöÄ –§–∞–∑–∞ 1.3: –ú–µ—Ö–∞–Ω–∏–∑–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–¶–µ–ª—å:** –ì—Ä–∞–¥—É–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–≤–µ—Ç–Ω—ã—Ö –º–µ—Ä

### –¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π

```python
class ActionType(Enum):
    MONITOR = "monitor"           # –£—Å–∏–ª–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
    WARN = "warn"                 # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    SOFT_LIMIT = "soft_limit"     # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
    DISCONNECT = "disconnect"     # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
    TEMP_BLOCK = "temp_block"     # –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    PERMANENT_BLOCK = "perm_block"# –ë–∞–Ω –¥–æ —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞
```

### –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —ç—Å–∫–∞–ª–∞—Ü–∏—è

```python
ESCALATION_MATRIX = {
    # (severity, violation_count) -> action
    ('low', 1): ('warn', None),
    ('low', 2): ('warn', None),
    ('low', 3): ('soft_limit', '30m'),

    ('medium', 1): ('warn', None),
    ('medium', 2): ('temp_block', '1h'),
    ('medium', 3): ('temp_block', '6h'),

    ('high', 1): ('temp_block', '1h'),
    ('high', 2): ('temp_block', '24h'),
    ('high', 3): ('temp_block', '7d'),

    ('critical', 1): ('temp_block', '24h'),
    ('critical', 2): ('permanent_block', None),
}
```

### –ú–µ—Ö–∞–Ω–∏–∑–º "–º—è–≥–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏" (Soft Limit)

```python
class SoftLimiter:
    """
    –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –±–µ–∑ –ø–æ–ª–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    """

    async def apply_soft_limit(self, user_uuid: str, duration: str):
        """
        –í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
        1. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –¥–æ 1 Mbit/s
        2. –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫—Ä–æ–º–µ –æ–¥–Ω–æ–≥–æ
        3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        """
        # Kick –ª–∏—à–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        active = await self.get_active_connections(user_uuid)
        if len(active) > 1:
            # –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å–∞–º–æ–µ —Å—Ç–∞—Ä–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
            for conn in sorted(active, key=lambda x: x.connected_at)[1:]:
                await self.disconnect(conn)

        # –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
        await self.api.update_user(user_uuid, speed_limit=1024*1024)  # 1 MB/s

        # –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–Ω—è—Ç–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
        await self.schedule_remove_limit(user_uuid, duration)
```

### –¢–∞–±–ª–∏—Ü–∞ temp_blocks (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)

```sql
CREATE TABLE temp_blocks (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,

    -- –ü—Ä–∏—á–∏–Ω–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    reason VARCHAR(255) NOT NULL,
    violation_id INT REFERENCES violations(id),
    violation_score DECIMAL(5,2),
    confidence DECIMAL(3,2),

    -- –¢–∏–ø –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    block_type VARCHAR(50) NOT NULL,  -- 'soft_limit', 'temp_block', 'permanent'
    speed_limit_bytes INT,            -- –¥–ª—è soft_limit

    -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏
    blocked_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    unblock_at TIMESTAMP WITH TIME ZONE,
    actual_unblock_at TIMESTAMP WITH TIME ZONE,

    -- –ö—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª
    blocked_by VARCHAR(50) NOT NULL,  -- 'auto:high_confidence', 'auto:medium', 'admin:123456'

    -- –°—Ç–∞—Ç—É—Å
    is_active BOOLEAN DEFAULT TRUE,
    was_appealed BOOLEAN DEFAULT FALSE,
    appeal_result VARCHAR(50),  -- 'approved', 'rejected', 'modified'

    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    metadata JSONB  -- snapshot –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
);
```

---

## üöÄ –§–∞–∑–∞ 1.4: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º

```
[ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–ø–∏–∫ notifications_topic_violations

[ ] –§–æ—Ä–º–∞—Ç –¥–ª—è –í–´–°–û–ö–û–ô —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:
    üö® –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

    üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @username (uuid: xxx)
    üìä –õ–∏–º–∏—Ç HWID: 3 | –ê–∫—Ç–∏–≤–Ω—ã—Ö IP: 7
    üéØ –°–∫–æ—Ä: 92/100 | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 95%

    üìç –î–µ—Ç–µ–∫—Ü–∏—è:
       ‚Ä¢ ‚ö†Ô∏è 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
       ‚Ä¢ üåç –†–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã: RU, DE, UA
       ‚Ä¢ üì± –†–∞–∑–Ω—ã–µ –û–°: Android, iOS, Windows

    üîí –î–µ–π—Å—Ç–≤–∏–µ: –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 24 —á–∞—Å–∞
    ‚è∞ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞: 27.01.2026 15:30 UTC

    [‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å] [‚è∞ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫] [‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]

[ ] –§–æ—Ä–º–∞—Ç –¥–ª—è –°–†–ï–î–ù–ï–ô —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:
    ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞

    üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @username
    üìä –õ–∏–º–∏—Ç HWID: 3 | –ê–∫—Ç–∏–≤–Ω—ã—Ö IP: 5
    üéØ –°–∫–æ—Ä: 72/100 | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 68%

    üìç –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:
       ‚Ä¢ üìà –ê–Ω–æ–º–∞–ª–∏—è: –æ–±—ã—á–Ω–æ 2 IP, —Å–µ–≥–æ–¥–Ω—è 5
       ‚Ä¢ üåç –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∞: –ì–µ—Ä–º–∞–Ω–∏—è (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)

    ‚ùì –°–º—è–≥—á–∞—é—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã:
       ‚Ä¢ üì± –û–¥–∏–Ω fingerprint (V2RayNG/Android)
       ‚Ä¢ ‚è± –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ IP (–Ω–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

    üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

    [üëÅ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥] [‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å] [üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å]
```

---

## üöÄ –§–∞–∑–∞ 1.5: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Anti-Abuse (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ)

```python
ANTI_ABUSE_SETTINGS = {
    # –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    'enabled': True,
    'detection_interval_seconds': 60,

    # –ü–æ—Ä–æ–≥–∏ —Å–∫–æ—Ä–∏–Ω–≥–∞
    'score_thresholds': {
        'monitor': 30,
        'warn': 50,
        'soft_limit': 65,
        'temp_block': 80,
        'hard_block': 95,
    },

    # –í–µ—Å–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ (—Å—É–º–º–∞ = 1.0)
    'factor_weights': {
        'temporal': 0.25,
        'geo': 0.25,
        'asn': 0.15,
        'profile': 0.20,
        'device': 0.15,
    },

    # –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
    'modifiers': {
        'mobile_carrier_multiplier': 0.7,
        'datacenter_multiplier': 1.5,
        'vpn_multiplier': 1.2,
        'new_user_grace_period_days': 7,  # –ù–æ–≤—ã–º –ø–æ–ª—å–∑. –¥–∞—ë–º –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è
    },

    # –≠—Å–∫–∞–ª–∞—Ü–∏—è
    'escalation': {
        'violation_memory_days': 30,  # –ü–æ–º–Ω–∏–º –Ω–∞—Ä—É—à–µ–Ω–∏—è 30 –¥–Ω–µ–π
        'reset_after_clean_days': 60, # –°–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞ –ø–æ—Å–ª–µ 60 –¥–Ω–µ–π –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π
    },

    # –ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞
    'auto_actions': {
        'high_confidence_threshold': 0.85,  # –ê–≤—Ç–æ-–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ > 85%
        'require_human_below': 0.70,         # –¢—Ä–µ–±—É–µ–º —á–µ–ª–æ–≤–µ–∫–∞ –ø—Ä–∏ < 70%
    },

    # Whitelist
    'whitelist': {
        'user_uuids': [],
        'ip_ranges': ['10.0.0.0/8', '192.168.0.0/16'],  # Internal
        'asns': [],  # Trusted ASNs
    },

    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
    'notifications': {
        'admin_on_violation': True,
        'admin_on_block': True,
        'admin_on_unblock': True,
    },
}
```

---

## üöÄ –§–∞–∑–∞ 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ –∏ –∞–ø–µ–ª–ª—è—Ü–∏–∏

### 2.1 –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

**–¶–µ–ª—å:** –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

**–ó–∞–¥–∞—á–∏:**

```
[ ] –†–∞–∑–¥–µ–ª "üîí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏" –≤ Telegram –±–æ—Ç–µ:
    ‚îú‚îÄ‚îÄ üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    ‚îÇ   ‚îî‚îÄ‚îÄ –°–ø–∏—Å–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ üìú –ò—Å—Ç–æ—Ä–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
    ‚îÇ   ‚îî‚îÄ‚îÄ –ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é/–¥–∞—Ç–µ
    ‚îú‚îÄ‚îÄ ‚ûï –°–æ–∑–¥–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
    ‚îÇ   ‚îî‚îÄ‚îÄ –†—É—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã
    ‚îî‚îÄ‚îÄ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

[ ] –ö–∞—Ä—Ç–æ—á–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
    üîí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ #1234

    üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @username
    üìä –¢–∏–ø: temp_block (24 —á–∞—Å–∞)
    üéØ –°–∫–æ—Ä: 85/100 | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 92%

    üìç –ü—Ä–∏—á–∏–Ω–∞: device_limit_exceeded
       ‚Ä¢ 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
       ‚Ä¢ –°—Ç—Ä–∞–Ω—ã: RU, DE, UA

    ‚è∞ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: 26.01.2026 12:00
    ‚è∞ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞: 27.01.2026 12:00

    [‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å] [‚è∞ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫] [üìù –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É]
```

### 2.2 –°–∏—Å—Ç–µ–º–∞ –∞–ø–µ–ª–ª—è—Ü–∏–π (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–æ–≤)

**–¶–µ–ª—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É

> **–í–∞–∂–Ω–æ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É (Telegram, email), –∞–¥–º–∏–Ω —Å–æ–∑–¥–∞—ë—Ç –∞–ø–µ–ª–ª—è—Ü–∏—é –≤ —Å–∏—Å—Ç–µ–º–µ.

**–ó–∞–¥–∞—á–∏:**

```
[ ] –†–∞–∑–¥–µ–ª "üìù –ê–ø–µ–ª–ª—è—Ü–∏–∏" –≤ –∞–¥–º–∏–Ω-–±–æ—Ç–µ:
    ‚îú‚îÄ‚îÄ üìã –û—Ç–∫—Ä—ã—Ç—ã–µ –∞–ø–µ–ª–ª—è—Ü–∏–∏
    ‚îú‚îÄ‚îÄ ‚úÖ –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ
    ‚îî‚îÄ‚îÄ ‚ûï –°–æ–∑–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é

[ ] –°–æ–∑–¥–∞–Ω–∏–µ –∞–ø–µ–ª–ª—è—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–º:
    üìù –ù–æ–≤–∞—è –∞–ø–µ–ª–ª—è—Ü–∏—è

    üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ü–æ–∏—Å–∫ –ø–æ username/UUID]
    üîí –°–≤—è–∑–∞–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞: [–í—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞]

    üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:
    ‚óã –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ / —Å–º–µ–Ω–∞ –ª–æ–∫–∞—Ü–∏–∏
    ‚óã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VPN
    ‚óã –°–º–µ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    ‚óã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
    ‚óã –î—Ä—É–≥–æ–µ

    üìù –û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
    [–¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ]

    [üíæ –°–æ–∑–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é]

[ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –∞–ø–µ–ª–ª—è—Ü–∏–∏:
    üìã –ê–ø–µ–ª–ª—è—Ü–∏—è #1234

    üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @username
    üîí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: 24 —á–∞—Å–∞ –∑–∞ device_limit_exceeded
    üìù –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ
    üí¨ –û–ø–∏—Å–∞–Ω–∏–µ: "–ë—ã–ª –≤ –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–µ, –ø–æ–¥–∫–ª—é—á–∞–ª—Å—è –∏–∑ –æ—Ç–µ–ª—è"

    üìä –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã:
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ IP –∏–∑ –ú–æ—Å–∫–≤—ã ‚Üí –°—Ç–∞–º–±—É–ª–∞ ‚Üí –î—É–±–∞—è        ‚îÇ
    ‚îÇ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã: —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ (6-8 —á–∞—Å–æ–≤)    ‚îÇ
    ‚îÇ Fingerprint: –æ–¥–∏–Ω (iPhone/Shadowrocket) ‚îÇ
    ‚îÇ –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: –ù–ï–¢          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

    üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –í–µ—Ä–æ—è—Ç–Ω–æ –ª–µ–≥–∏—Ç–∏–º–Ω–æ (78%)

    [‚úÖ –û–¥–æ–±—Ä–∏—Ç—å] [‚úÖ –û–¥–æ–±—Ä–∏—Ç—å + Whitelist] [‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å]

[ ] –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏:
    - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Trust Score (+10)
    - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ whitelist
    - –ó–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –æ–±—É—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
```

---

## üöÄ –§–∞–∑–∞ 3: –ë–∏–ª–ª–∏–Ω–≥ –∏ —Ç–∞—Ä–∏—Ñ—ã

### 3.1 –°–∏—Å—Ç–µ–º–∞ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

```
[ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –±–∏–ª–ª–∏–Ω–≥–æ–º Remnawave

[ ] –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º:

    üì¶ BASIC (–±–∞–∑–æ–≤—ã–π)
    - HWID –ª–∏–º–∏—Ç: 1 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
    - –°—Ç—Ä–æ–≥–∏–π Anti-Abuse
    - –ù–µ—Ç grace period

    üì¶ STANDARD (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
    - HWID –ª–∏–º–∏—Ç: 3 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Anti-Abuse
    - 7 –¥–Ω–µ–π grace period

    üì¶ PREMIUM (–ø—Ä–µ–º–∏—É–º)
    - HWID –ª–∏–º–∏—Ç: 5 —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    - –ú—è–≥–∫–∏–π Anti-Abuse (–≤—ã—à–µ –ø–æ—Ä–æ–≥–∏)
    - 14 –¥–Ω–µ–π grace period

    üì¶ FAMILY (—Å–µ–º–µ–π–Ω—ã–π)
    - HWID –ª–∏–º–∏—Ç: 10 —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Anti-Abuse
    - –û–∂–∏–¥–∞–µ–º —Ä–∞–∑–Ω—ã–µ –≥–µ–æ-–ª–æ–∫–∞—Ü–∏–∏
```

### 3.2 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –±–∏–ª–ª–∏–Ω–≥—É

```
[ ] –ü—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è:
    - –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ (–ø–∞—É–∑–∞ –ø–æ–¥–ø–∏—Å–∫–∏)
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è—Ç—å –ø–æ—Å–ª–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

[ ] –®—Ç—Ä–∞—Ñ–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
    - 3+ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∑–∞ –º–µ—Å—è—Ü = -7 –¥–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
    - –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è = –ø–æ–Ω–∏–∂–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
```

---

## üöÄ –§–∞–∑–∞ 4: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### 4.1 –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è IP (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

```
[ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å MaxMind GeoLite2 –∏–ª–∏ ip-api.com

[ ] –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É user_connections:
    ALTER TABLE user_connections ADD COLUMN
        country_code VARCHAR(2),
        country_name VARCHAR(100),
        city VARCHAR(100),
        region VARCHAR(100),
        latitude DECIMAL(9,6),
        longitude DECIMAL(9,6),
        timezone VARCHAR(50),
        asn INT,
        asn_org VARCHAR(200),
        connection_type VARCHAR(20),  -- 'residential', 'mobile', 'datacenter'
        is_proxy BOOLEAN DEFAULT FALSE,
        is_vpn BOOLEAN DEFAULT FALSE,
        is_tor BOOLEAN DEFAULT FALSE;
```

### 4.2 –î–∞—à–±–æ—Ä–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (Telegram)

```
[ ] –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ /analytics –∏–ª–∏ —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é

[ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Anti-Abuse –∑–∞ –ø–µ—Ä–∏–æ–¥:
    üìä Anti-Abuse —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (7 –¥–Ω–µ–π)

    üîç –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 1,234
    ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π: 45
    üîí –ë–ª–æ–∫–∏—Ä–æ–≤–æ–∫: 12
       ‚îú‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö: 8
       ‚îî‚îÄ –†—É—á–Ω—ã—Ö: 4

    üìà –ü–æ severity:
       ‚Ä¢ Low: 28 (62%)
       ‚Ä¢ Medium: 12 (27%)
       ‚Ä¢ High: 4 (9%)
       ‚Ä¢ Critical: 1 (2%)

    üéØ –¢–æ—á–Ω–æ—Å—Ç—å (–ø–æ –∞–ø–µ–ª–ª—è—Ü–∏—è–º):
       ‚Ä¢ –û–¥–æ–±—Ä–µ–Ω–æ –∞–ø–µ–ª–ª—è—Ü–∏–π: 3/15 (20%)
       ‚Ä¢ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π: 80%

    üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π:
       ‚Ä¢ RU: 25
       ‚Ä¢ UA: 8
       ‚Ä¢ DE: 5
       ‚Ä¢ Other: 7

[ ] –¢–æ–ø –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π:
    üèÜ –¢–æ–ø-10 –ø–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è–º (30 –¥–Ω–µ–π)

    1. @user1 - 5 –Ω–∞—Ä—É—à–µ–Ω–∏–π (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
    2. @user2 - 4 –Ω–∞—Ä—É—à–µ–Ω–∏—è (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥—ë–Ω)
    3. @user3 - 3 –Ω–∞—Ä—É—à–µ–Ω–∏—è (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
    ...
```

### 4.3 –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤

```
[ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∞:
    - CSV —Å–æ –≤—Å–µ–º–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
    - –°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç –≤ PDF
    - JSON –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
```

### 4.4 –°–∏—Å—Ç–µ–º–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Trust Score)

```python
class TrustScoreSystem:
    """
    –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """

    INITIAL_SCORE = 100
    MAX_SCORE = 150
    MIN_SCORE = 0

    SCORE_CHANGES = {
        'violation_low': -5,
        'violation_medium': -15,
        'violation_high': -30,
        'violation_critical': -50,
        'appeal_approved': +10,        # –ù–∞—à–∞ –æ—à–∏–±–∫–∞
        'clean_week': +2,              # –ù–µ–¥–µ–ª—è –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π
        'clean_month': +10,            # –ú–µ—Å—è—Ü –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π
        'long_time_customer': +20,     # > 6 –º–µ—Å—è—Ü–µ–≤ –∫–ª–∏–µ–Ω—Ç
    }

    SCORE_EFFECTS = {
        (0, 20): {
            'action': 'permanent_block',
            'description': '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏',
        },
        (20, 40): {
            'action': 'reduce_hwid_limit',
            'modifier': -1,
            'description': '–°–Ω–∏–∂–µ–Ω –ª–∏–º–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤',
        },
        (40, 60): {
            'action': 'strict_monitoring',
            'description': '–°—Ç—Ä–æ–≥–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥',
        },
        (60, 80): {
            'action': 'standard',
            'description': '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º',
        },
        (80, 120): {
            'action': 'relaxed',
            'modifier': 0.8,  # –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è —Å–∫–æ—Ä–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π
            'description': '–î–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
        },
        (120, 151): {
            'action': 'trusted',
            'modifier': 0.6,
            'description': 'VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
        },
    }
```

---

## üöÄ –§–∞–∑–∞ 5: –í–µ–±-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 5.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
remnawave-admin/
‚îú‚îÄ‚îÄ src/                      # Telegram –±–æ—Ç (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îú‚îÄ‚îÄ backend/              # FastAPI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nodes.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ violations.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ deps.py       # Dependencies
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ permissions.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ frontend/             # React + TypeScript
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ violations/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analytics/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Users.tsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserDetail.tsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Violations.tsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AntiAbuseCenter.tsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Analytics.tsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Settings.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ store/        # Zustand/Redux
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îÇ       ‚îú‚îÄ‚îÄ package.json
‚îÇ       ‚îî‚îÄ‚îÄ vite.config.ts
‚îî‚îÄ‚îÄ docker-compose.yml
```

### 5.2 –°—Ç—Ä–∞–Ω–∏—Ü—ã –≤–µ–±-–ø–∞–Ω–µ–ª–∏

#### Dashboard
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìä Dashboard                              [üîî 3] [Admin ‚ñº]     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  1,847  ‚îÇ ‚îÇ   124   ‚îÇ ‚îÇ   12    ‚îÇ ‚îÇ    5    ‚îÇ ‚îÇ    3    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Users   ‚îÇ ‚îÇ Online  ‚îÇ ‚îÇ Nodes   ‚îÇ ‚îÇ Blocked ‚îÇ ‚îÇ Alerts  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Total   ‚îÇ ‚îÇ   Now   ‚îÇ ‚îÇ Active  ‚îÇ ‚îÇ  Today  ‚îÇ ‚îÇ Pending ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ üìà Connections (24h)           ‚îÇ ‚îÇ üö® Violations (7d)       ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                ‚îÇ ‚îÇ                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    120 ‚îÄ‚îê      ‚ï≠‚îÄ‚îÄ‚ïÆ            ‚îÇ ‚îÇ  Low ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 62%     ‚îÇ‚îÇ
‚îÇ  ‚îÇ    100 ‚îÄ‚î§   ‚ï≠‚îÄ‚îÄ‚ïØ  ‚ï∞‚îÄ‚îÄ‚ïÆ        ‚îÇ ‚îÇ  Med ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 27%     ‚îÇ‚îÇ
‚îÇ  ‚îÇ     80 ‚îÄ‚î§‚ï≠‚îÄ‚îÄ‚ïØ        ‚ï∞‚îÄ‚îÄ‚ïÆ     ‚îÇ ‚îÇ  High ‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  9%     ‚îÇ‚îÇ
‚îÇ  ‚îÇ     60 ‚îÄ‚îº‚ïØ              ‚ï∞‚îÄ    ‚îÇ ‚îÇ  Crit ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  2%     ‚îÇ‚îÇ
‚îÇ  ‚îÇ         00  06  12  18  24    ‚îÇ ‚îÇ                          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ üî¥ Live Activity                              [Filter ‚ñº]    ‚îÇ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ  ‚îÇ üü¢ 12:45:32  @john connected from 185.x.x.x (Moscow)       ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚ö†Ô∏è 12:44:15  Violation detected for @alice (score: 78)     ‚îÇ‚îÇ
‚îÇ  ‚îÇ üîí 12:42:08  @bob blocked (auto, 24h, device_limit)        ‚îÇ‚îÇ
‚îÇ  ‚îÇ üîÑ 12:40:55  Node DE-1 restarted by admin                  ‚îÇ‚îÇ
‚îÇ  ‚îÇ üü¢ 12:38:22  @charlie connected from 91.x.x.x (Berlin)     ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Anti-Abuse Center
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üõ° Anti-Abuse Center                                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [Live Monitor] [Violations] [Blocks] [Appeals] [Settings]      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  üî¥ Requires Attention (3)                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ ‚ö†Ô∏è @suspicious_user                                         ‚îÇ‚îÇ
‚îÇ  ‚îÇ    Score: 72 | Confidence: 65% | IPs: 6 | Limit: 3          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    Factors: geo_anomaly, profile_deviation                  ‚îÇ‚îÇ
‚îÇ  ‚îÇ    [üëÅ Details] [‚ö†Ô∏è Warn] [üîí Block] [‚úÖ Whitelist]          ‚îÇ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ  ‚îÇ üö® @another_user                                            ‚îÇ‚îÇ
‚îÇ  ‚îÇ    Score: 88 | Confidence: 82% | IPs: 8 | Limit: 2          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    Factors: simultaneous_connections, multiple_countries    ‚îÇ‚îÇ
‚îÇ  ‚îÇ    [üëÅ Details] [‚ö†Ô∏è Warn] [üîí Block] [‚úÖ Whitelist]          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  üìä Active Connections Map                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                    üó∫ World Map                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ     [Visual map with dots for active connections]           ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ  Legend: üü¢ Normal  üü° Monitoring  üî¥ Suspicious            ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### User Detail (—Å Anti-Abuse –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üë§ User: @username                              [Edit] [Block] ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ üìã Profile           ‚îÇ  ‚îÇ üõ° Anti-Abuse Status              ‚îÇ‚îÇ
‚îÇ  ‚îÇ                      ‚îÇ  ‚îÇ                                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ UUID: abc-123-...    ‚îÇ  ‚îÇ Trust Score: 85/150 üü¢            ‚îÇ‚îÇ
‚îÇ  ‚îÇ Email: user@mail.com ‚îÇ  ‚îÇ Status: Trusted User              ‚îÇ‚îÇ
‚îÇ  ‚îÇ Telegram: @username  ‚îÇ  ‚îÇ                                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ Status: üü¢ Active    ‚îÇ  ‚îÇ Violations (30d): 1               ‚îÇ‚îÇ
‚îÇ  ‚îÇ Created: 2025-06-15  ‚îÇ  ‚îÇ Last violation: 15 days ago       ‚îÇ‚îÇ
‚îÇ  ‚îÇ Expires: 2026-06-15  ‚îÇ  ‚îÇ Current score: 12 (low risk)      ‚îÇ‚îÇ
‚îÇ  ‚îÇ                      ‚îÇ  ‚îÇ                                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ HWID Limit: 3        ‚îÇ  ‚îÇ [üìä Full History] [‚öôÔ∏è Settings]   ‚îÇ‚îÇ
‚îÇ  ‚îÇ Traffic: 45.2 GB     ‚îÇ  ‚îÇ                                   ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  üì± Active Connections (2/3)                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Device          ‚îÇ IP           ‚îÇ Location    ‚îÇ Since       ‚îÇ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ  ‚îÇ Android/V2RayNG ‚îÇ 185.x.x.x    ‚îÇ Moscow, RU  ‚îÇ 2h ago      ‚îÇ‚îÇ
‚îÇ  ‚îÇ iOS/Shadowrocket‚îÇ 185.x.x.y    ‚îÇ Moscow, RU  ‚îÇ 5h ago      ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  üìà Connection History (7 days)                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ  IPs ‚îÇ     ‚ï≠‚îÄ‚ïÆ                                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ   4  ‚îÇ  ‚ï≠‚îÄ‚îÄ‚ïØ ‚ï∞‚îÄ‚îÄ‚ïÆ     ‚ï≠‚îÄ‚îÄ‚ïÆ                                 ‚îÇ‚îÇ
‚îÇ  ‚îÇ   2  ‚îÇ‚îÄ‚îÄ‚ïØ       ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ  ‚ï∞‚îÄ‚îÄ                               ‚îÇ‚îÇ
‚îÇ  ‚îÇ      ‚îÇ  Mon Tue Wed Thu Fri Sat Sun                        ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5.3 API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ)

```
# Authentication
POST   /api/v1/auth/telegram           # Telegram Login Widget
POST   /api/v1/auth/refresh            # Refresh JWT
POST   /api/v1/auth/logout             # Logout

# Users
GET    /api/v1/users                   # List (paginated, filterable)
GET    /api/v1/users/:uuid             # Get user with anti-abuse data
PATCH  /api/v1/users/:uuid             # Update user
GET    /api/v1/users/:uuid/connections # Connection history
GET    /api/v1/users/:uuid/violations  # Violation history
GET    /api/v1/users/:uuid/trust-score # Trust score details
POST   /api/v1/users/:uuid/whitelist   # Add to whitelist

# Violations
GET    /api/v1/violations              # List violations
GET    /api/v1/violations/:id          # Violation details
POST   /api/v1/violations/:id/resolve  # Resolve (approve/reject)
GET    /api/v1/violations/pending      # Pending review

# Blocks
GET    /api/v1/blocks                  # Active blocks
GET    /api/v1/blocks/history          # Block history
POST   /api/v1/blocks                  # Manual block
DELETE /api/v1/blocks/:id              # Unblock
PATCH  /api/v1/blocks/:id              # Modify block (extend/reduce)

# Appeals
GET    /api/v1/appeals                 # List appeals
GET    /api/v1/appeals/:id             # Appeal details
POST   /api/v1/appeals/:id/decide      # Approve/reject appeal

# Analytics
GET    /api/v1/analytics/overview      # Dashboard stats
GET    /api/v1/analytics/violations    # Violation stats
GET    /api/v1/analytics/connections   # Connection stats
GET    /api/v1/analytics/geo           # Geographic distribution
GET    /api/v1/analytics/trends        # Trends over time
POST   /api/v1/analytics/export        # Export report

# Anti-Abuse Settings
GET    /api/v1/anti-abuse/settings     # Current settings
PATCH  /api/v1/anti-abuse/settings     # Update settings
GET    /api/v1/anti-abuse/whitelist    # Whitelist
POST   /api/v1/anti-abuse/whitelist    # Add to whitelist
DELETE /api/v1/anti-abuse/whitelist/:id# Remove from whitelist

# Real-time
WS     /api/v1/ws                      # WebSocket for live updates
```

---

## üöÄ –§–∞–∑–∞ 6: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### 6.1 Rules Engine

```
[ ] –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–∞–≤–∏–ª

–ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìú Rule: High Traffic Alert                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  IF:                                                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ [user.traffic_today] [>] [50 GB]                            ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                           [+ Add Condition] ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  AND:                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ [user.subscription_type] [!=] [unlimited]                   ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  THEN:                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Action: [Send notification ‚ñº]                               ‚îÇ‚îÇ
‚îÇ  ‚îÇ Target: [Admin group ‚ñº]                                     ‚îÇ‚îÇ
‚îÇ  ‚îÇ Message: "User {username} used {traffic} today"             ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                           [+ Add Action]    ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  [üíæ Save Rule] [‚ñ∂Ô∏è Test Rule] [üóë Delete]                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

[ ] –ü—Ä–∏–º–µ—Ä—ã –≥–æ—Ç–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª:
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ traffic > X
    - –ê–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –¥–ª—è trusted users
    - –ê–≤—Ç–æ-–±–ª–æ–∫ –ø—Ä–∏ score > 95
    - –û—Ç—á—ë—Ç –ø—Ä–∏ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–µ
    - –ê–ª–µ—Ä—Ç –ø—Ä–∏ > N –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö —Å –æ–¥–Ω–æ–≥–æ IP
```

### 6.2 Scheduled Tasks

```
[ ] –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á:
    - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è–º (—É—Ç—Ä–æ–º)
    - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ –¥–ª—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
    - –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (> 90 –¥–Ω–µ–π)
    - –ü–µ—Ä–µ—Å—á—ë—Ç Trust Score (—Ä–∞–∑ –≤ –¥–µ–Ω—å)
    - Backup –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫ (–∑–∞ 3 –¥–Ω—è)
```

### 6.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
[ ] –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã:
    - Discord webhooks –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    - Email (SMTP) –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤
    - Slack –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
    - Prometheus –º–µ—Ç—Ä–∏–∫–∏
    - Grafana –¥–∞—à–±–æ—Ä–¥—ã
    - Sentry –¥–ª—è –æ—à–∏–±–æ–∫
```

---

## üìÖ –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

### ‚ö†Ô∏è –≠—Ç–∞–ø 0: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (3-4 –Ω–µ–¥–µ–ª–∏) ‚Äî –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

> **–ë–µ–∑ —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ Anti-Abuse –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω!**

```
–ù–µ–¥–µ–ª—è 1:
‚îú‚îÄ‚îÄ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ Xray (—Ñ–æ—Ä–º–∞—Ç—ã, —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ)
‚îú‚îÄ‚îÄ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Node Agent
‚îú‚îÄ‚îÄ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Collector API
‚îî‚îÄ‚îÄ –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤ vs Stats API)

–ù–µ–¥–µ–ª—è 2:
‚îú‚îÄ‚îÄ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Node Agent (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ –ü–∞—Ä—Å–µ—Ä access.log Xray
‚îÇ   ‚îú‚îÄ‚îÄ HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Collector API –≤ Admin Bot
‚îÇ   ‚îú‚îÄ‚îÄ Endpoint /api/v1/connections/batch
‚îÇ   ‚îú‚îÄ‚îÄ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ –ó–∞–ø–∏—Å—å –≤ user_connections
‚îî‚îÄ‚îÄ Docker –æ–±—Ä–∞–∑ Node Agent

–ù–µ–¥–µ–ª—è 3-4:
‚îú‚îÄ‚îÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –Ω–æ–¥–µ
‚îú‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (—Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (batching, —Å–∂–∞—Ç–∏–µ)
‚îú‚îÄ‚îÄ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∞–≥–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è –∞–≥–µ–Ω—Ç–æ–≤

–†–µ–∑—É–ª—å—Ç–∞—Ç: –î–∞–Ω–Ω—ã–µ –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö –ø–æ—Å—Ç—É–ø–∞—é—Ç –≤ —Å–∏—Å—Ç–µ–º—É ‚úÖ
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ï—Å–ª–∏ Remnawave –¥–æ–±–∞–≤–∏—Ç API –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π ‚Äî —ç—Ç–∞–ø —É–ø—Ä–æ—â–∞–µ—Ç—Å—è.

---

### –≠—Ç–∞–ø 1: MVP Anti-Abuse (4-6 –Ω–µ–¥–µ–ª—å)

> **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç:** –≠—Ç–∞–ø 0 (–¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –ø–æ—Å—Ç—É–ø–∞—Ç—å)

```
–ù–µ–¥–µ–ª—è 1-2:
‚îú‚îÄ‚îÄ –ë–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ IP (–Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤)
‚îú‚îÄ‚îÄ –ü—Ä–æ—Å—Ç–æ–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ –ü–æ–¥—Å—á—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP –∑–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ
‚îî‚îÄ‚îÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GeoIP (—Å—Ç—Ä–∞–Ω–∞, –≥–æ—Ä–æ–¥)

–ù–µ–¥–µ–ª—è 3-4:
‚îú‚îÄ‚îÄ –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (auto + manual)
‚îú‚îÄ‚îÄ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
‚îú‚îÄ‚îÄ –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª Anti-Abuse –≤ Telegram
‚îî‚îÄ‚îÄ Whitelist (–∏—Å–∫–ª—é—á–µ–Ω–∏—è)

–ù–µ–¥–µ–ª—è 5-6:
‚îú‚îÄ‚îÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –ø–æ—Ä–æ–≥–æ–≤ (false positives)
‚îî‚îÄ‚îÄ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (4-6 –Ω–µ–¥–µ–ª—å)
```
‚îú‚îÄ‚îÄ ASN –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (mobile/residential/datacenter)
‚îú‚îÄ‚îÄ –ú–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—ã–π —Å–∫–æ—Ä–∏–Ω–≥ (5 —Ñ–∞–∫—Ç–æ—Ä–æ–≤)
‚îú‚îÄ‚îÄ –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (baseline)
‚îú‚îÄ‚îÄ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (Confidence)
‚îú‚îÄ‚îÄ Device fingerprinting (User-Agent –∞–Ω–∞–ª–∏–∑)
‚îî‚îÄ‚îÄ Impossible travel detection
```

---

### –≠—Ç–∞–ø 3: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ –∏ –∞–ø–µ–ª–ª—è—Ü–∏–∏ (2-3 –Ω–µ–¥–µ–ª–∏)
```
‚îú‚îÄ‚îÄ –†–∞–∑–¥–µ–ª –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –∞–¥–º–∏–Ω-–±–æ—Ç–µ
‚îú‚îÄ‚îÄ –°–∏—Å—Ç–µ–º–∞ –∞–ø–µ–ª–ª—è—Ü–∏–π (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–æ–≤)
‚îú‚îÄ‚îÄ Trust Score —Å–∏—Å—Ç–µ–º–∞
‚îú‚îÄ‚îÄ –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —ç—Å–∫–∞–ª–∞—Ü–∏—è
‚îî‚îÄ‚îÄ Soft limit (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏)
```

---

### –≠—Ç–∞–ø 4: –ë–∏–ª–ª–∏–Ω–≥ –∏ —Ç–∞—Ä–∏—Ñ—ã (2-3 –Ω–µ–¥–µ–ª–∏)
```
‚îú‚îÄ‚îÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∏–ª–ª–∏–Ω–≥–æ–º Remnawave
‚îú‚îÄ‚îÄ –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–ø–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
‚îî‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Anti-Abuse –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
```

---

### –≠—Ç–∞–ø 5: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (3-4 –Ω–µ–¥–µ–ª–∏)
```
‚îú‚îÄ‚îÄ –î–∞—à–±–æ—Ä–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ Telegram
‚îú‚îÄ‚îÄ Live-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (–¥–∞–Ω–Ω—ã–µ –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤)
‚îú‚îÄ‚îÄ –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤ (CSV, PDF, JSON)
‚îú‚îÄ‚îÄ –¢–æ–ø –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π –∏ —Ç—Ä–µ–Ω–¥—ã
‚îî‚îÄ‚îÄ –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
```

---

### –≠—Ç–∞–ø 6: –í–µ–±-–ø–∞–Ω–µ–ª—å (8-12 –Ω–µ–¥–µ–ª—å)
```
‚îú‚îÄ‚îÄ Backend API (FastAPI)
‚îú‚îÄ‚îÄ Frontend (React + TypeScript)
‚îú‚îÄ‚îÄ Dashboard —Å real-time –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
‚îú‚îÄ‚îÄ Anti-Abuse Center (live monitor)
‚îú‚îÄ‚îÄ Real-time WebSocket
‚îî‚îÄ‚îÄ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Telegram Login + JWT)
```

---

### –≠—Ç–∞–ø 7: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (4-6 –Ω–µ–¥–µ–ª—å)
```
‚îú‚îÄ‚îÄ Rules Engine (–≤–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä)
‚îú‚îÄ‚îÄ Scheduled tasks
‚îú‚îÄ‚îÄ –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Discord, Slack, Email)
‚îî‚îÄ‚îÄ Prometheus/Grafana –º–µ—Ç—Ä–∏–∫–∏
```

---

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

| –≠—Ç–∞–ø | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|------|--------------|-------------|
| **0. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** | 3-4 –Ω–µ–¥–µ–ª–∏ | ‚Äî |
| 1. MVP Anti-Abuse | 4-6 –Ω–µ–¥–µ–ª—å | –≠—Ç–∞–ø 0 |
| 2. –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç. –¥–µ—Ç–µ–∫—Ç. | 4-6 –Ω–µ–¥–µ–ª—å | –≠—Ç–∞–ø 1 |
| 3. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ | 2-3 –Ω–µ–¥–µ–ª–∏ | –≠—Ç–∞–ø 1 |
| 4. –ë–∏–ª–ª–∏–Ω–≥ | 2-3 –Ω–µ–¥–µ–ª–∏ | –≠—Ç–∞–ø 1 |
| 5. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ | 3-4 –Ω–µ–¥–µ–ª–∏ | –≠—Ç–∞–ø 2 |
| 6. –í–µ–±-–ø–∞–Ω–µ–ª—å | 8-12 –Ω–µ–¥–µ–ª—å | –≠—Ç–∞–ø 3, 5 |
| 7. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è | 4-6 –Ω–µ–¥–µ–ª—å | –≠—Ç–∞–ø 6 |
| **–ò–¢–û–ì–û** | **~30-45 –Ω–µ–¥–µ–ª—å** | |

```
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å:
–≠—Ç–∞–ø 0 ‚Üí –≠—Ç–∞–ø 1 ‚Üí –≠—Ç–∞–ø 2 ‚Üí –≠—Ç–∞–ø 5 ‚Üí –≠—Ç–∞–ø 6 ‚Üí –≠—Ç–∞–ø 7

–ú–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–ø–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1):
‚îú‚îÄ‚îÄ –≠—Ç–∞–ø 3 (–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
‚îî‚îÄ‚îÄ –≠—Ç–∞–ø 4 (–ë–∏–ª–ª–∏–Ω–≥)
```

---

## üóÉÔ∏è –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–∏–≥—Ä–∞—Ü–∏—è 0003: Anti-Abuse (–±–∞–∑–æ–≤–∞—è)

```sql
-- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ user_connections
ALTER TABLE user_connections ADD COLUMN IF NOT EXISTS
    user_agent TEXT,
    device_fingerprint VARCHAR(64),
    country_code VARCHAR(2),
    country_name VARCHAR(100),
    city VARCHAR(100),
    region VARCHAR(100),
    latitude DECIMAL(9,6),
    longitude DECIMAL(9,6),
    timezone VARCHAR(50),
    asn INT,
    asn_org VARCHAR(200),
    connection_type VARCHAR(20),
    is_proxy BOOLEAN DEFAULT FALSE,
    is_vpn BOOLEAN DEFAULT FALSE,
    is_tor BOOLEAN DEFAULT FALSE;

CREATE INDEX idx_user_connections_geo ON user_connections(country_code, city);
CREATE INDEX idx_user_connections_asn ON user_connections(asn);

-- –ù–∞—Ä—É—à–µ–Ω–∏—è
CREATE TABLE violations (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,
    violation_type VARCHAR(50) NOT NULL,

    -- –°–∫–æ—Ä–∏–Ω–≥
    total_score DECIMAL(5,2) NOT NULL,
    confidence DECIMAL(3,2) NOT NULL,
    severity VARCHAR(20) NOT NULL,

    -- –î–µ—Ç–∞–ª–∏
    hwid_limit INT NOT NULL,
    detected_ips INT NOT NULL,
    simultaneous_connections INT DEFAULT 0,

    -- Breakdown –ø–æ —Ñ–∞–∫—Ç–æ—Ä–∞–º
    score_breakdown JSONB NOT NULL,
    /*
    {
        "temporal": {"score": 80, "reason": "simultaneous_connections"},
        "geo": {"score": 50, "countries": ["RU", "DE"]},
        "asn": {"score": 0, "type": "mobile"},
        "profile": {"score": 45, "deviation": "high"},
        "device": {"score": 40, "os_count": 3}
    }
    */

    -- IP –∞–¥—Ä–µ—Å–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    ip_addresses JSONB NOT NULL,
    /*
    [
        {"ip": "185.x.x.x", "country": "RU", "city": "Moscow", "asn": "MTS"},
        {"ip": "91.x.x.x", "country": "DE", "city": "Berlin", "asn": "Hetzner"}
    ]
    */

    -- –î–µ–π—Å—Ç–≤–∏–µ
    action_taken VARCHAR(50),
    action_reason TEXT,

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    resolved_at TIMESTAMP WITH TIME ZONE,
    resolved_by BIGINT,
    resolution_type VARCHAR(50),  -- 'auto_expired', 'admin_approved', 'admin_rejected'
    resolution_notes TEXT
);

CREATE INDEX idx_violations_user ON violations(user_uuid);
CREATE INDEX idx_violations_created ON violations(created_at);
CREATE INDEX idx_violations_severity ON violations(severity);
CREATE INDEX idx_violations_unresolved ON violations(resolved_at) WHERE resolved_at IS NULL;

-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
CREATE TABLE temp_blocks (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,
    violation_id INT REFERENCES violations(id),

    -- –¢–∏–ø –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    block_type VARCHAR(50) NOT NULL,  -- 'soft_limit', 'temp_block', 'permanent'

    -- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
    reason VARCHAR(255) NOT NULL,
    violation_score DECIMAL(5,2),
    confidence DECIMAL(3,2),
    speed_limit_bytes BIGINT,  -- –¥–ª—è soft_limit

    -- –í—Ä–µ–º—è
    blocked_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    unblock_at TIMESTAMP WITH TIME ZONE,
    actual_unblock_at TIMESTAMP WITH TIME ZONE,

    -- –ö—Ç–æ
    blocked_by VARCHAR(100) NOT NULL,  -- 'auto:high_confidence', 'admin:123456789'
    unblocked_by VARCHAR(100),

    -- –°—Ç–∞—Ç—É—Å
    is_active BOOLEAN DEFAULT TRUE,

    -- –ê–ø–µ–ª–ª—è—Ü–∏—è
    appeal_id INT,

    -- Snapshot –¥–∞–Ω–Ω—ã—Ö
    metadata JSONB
);

CREATE INDEX idx_blocks_user ON temp_blocks(user_uuid);
CREATE INDEX idx_blocks_active ON temp_blocks(is_active) WHERE is_active = TRUE;
CREATE INDEX idx_blocks_unblock ON temp_blocks(unblock_at) WHERE is_active = TRUE;

-- Trust Score
CREATE TABLE user_trust_scores (
    id SERIAL PRIMARY KEY,
    user_uuid UUID UNIQUE NOT NULL,

    current_score INT NOT NULL DEFAULT 100,
    max_score INT NOT NULL DEFAULT 100,
    min_score INT NOT NULL DEFAULT 100,

    -- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
    score_history JSONB DEFAULT '[]',
    /*
    [
        {"date": "2026-01-15", "change": -15, "reason": "violation_medium", "new_score": 85},
        {"date": "2026-01-20", "change": +2, "reason": "clean_week", "new_score": 87}
    ]
    */

    -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    total_violations INT DEFAULT 0,
    violations_30d INT DEFAULT 0,
    last_violation_at TIMESTAMP WITH TIME ZONE,
    clean_days INT DEFAULT 0,

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_trust_scores_score ON user_trust_scores(current_score);

-- –ê–ø–µ–ª–ª—è—Ü–∏–∏
CREATE TABLE appeals (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,
    block_id INT REFERENCES temp_blocks(id),
    violation_id INT REFERENCES violations(id),

    -- –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
    reason_category VARCHAR(50),  -- 'traveling', 'vpn_usage', 'device_change', 'error', 'other'
    user_message TEXT NOT NULL,

    -- –°—Ç–∞—Ç—É—Å
    status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'approved', 'rejected', 'auto_resolved'

    -- –†–µ—à–µ–Ω–∏–µ
    decided_by BIGINT,
    decided_at TIMESTAMP WITH TIME ZONE,
    decision_notes TEXT,

    -- –î–µ–π—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è
    action_taken VARCHAR(50),  -- 'unblock', 'reduce_block', 'whitelist', 'no_action'

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_appeals_status ON appeals(status);
CREATE INDEX idx_appeals_user ON appeals(user_uuid);

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Anti-Abuse
CREATE TABLE anti_abuse_settings (
    id SERIAL PRIMARY KEY,
    setting_key VARCHAR(100) UNIQUE NOT NULL,
    setting_value JSONB NOT NULL,
    description TEXT,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_by BIGINT
);

-- Whitelist
CREATE TABLE anti_abuse_whitelist (
    id SERIAL PRIMARY KEY,

    -- –¢–∏–ø whitelist
    whitelist_type VARCHAR(20) NOT NULL,  -- 'user', 'ip_range', 'asn'

    -- –ó–Ω–∞—á–µ–Ω–∏–µ
    user_uuid UUID,
    ip_range CIDR,
    asn INT,

    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    reason TEXT,
    added_by BIGINT NOT NULL,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE,  -- NULL = permanent

    CONSTRAINT whitelist_value_check CHECK (
        (whitelist_type = 'user' AND user_uuid IS NOT NULL) OR
        (whitelist_type = 'ip_range' AND ip_range IS NOT NULL) OR
        (whitelist_type = 'asn' AND asn IS NOT NULL)
    )
);

CREATE INDEX idx_whitelist_user ON anti_abuse_whitelist(user_uuid) WHERE user_uuid IS NOT NULL;
CREATE INDEX idx_whitelist_type ON anti_abuse_whitelist(whitelist_type);

-- –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (baseline)
CREATE TABLE user_behavior_profiles (
    id SERIAL PRIMARY KEY,
    user_uuid UUID UNIQUE NOT NULL,

    -- –¢–∏–ø–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    typical_countries JSONB DEFAULT '[]',
    typical_cities JSONB DEFAULT '[]',
    typical_asns JSONB DEFAULT '[]',

    -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    avg_daily_unique_ips DECIMAL(5,2),
    max_daily_unique_ips INT,
    avg_session_duration_minutes INT,
    typical_hours JSONB DEFAULT '[]',  -- [9, 10, 11, 18, 19, 20, 21, 22]

    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    data_points INT DEFAULT 0,  -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–∞–Ω–Ω—ã—Ö
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### –ú–∏–≥—Ä–∞—Ü–∏—è 0004: –í–µ–±-–ø–∞–Ω–µ–ª—å

```sql
-- –†–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
CREATE TYPE admin_role AS ENUM ('super_admin', 'admin', 'moderator', 'viewer');

-- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
CREATE TABLE admins (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(100),
    first_name VARCHAR(100),
    role admin_role NOT NULL DEFAULT 'viewer',

    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by BIGINT,

    -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    settings JSONB DEFAULT '{}'
);

-- –°–µ—Å—Å–∏–∏
CREATE TABLE admin_sessions (
    id SERIAL PRIMARY KEY,
    admin_id INT REFERENCES admins(id),

    jwt_token_hash VARCHAR(64) UNIQUE,
    refresh_token_hash VARCHAR(64),

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
    last_activity_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

    ip_address INET,
    user_agent TEXT,

    is_active BOOLEAN DEFAULT TRUE
);

CREATE INDEX idx_sessions_active ON admin_sessions(is_active, expires_at);

-- –ê—É–¥–∏—Ç –ª–æ–≥
CREATE TABLE admin_audit_log (
    id SERIAL PRIMARY KEY,
    admin_id INT REFERENCES admins(id),

    action VARCHAR(100) NOT NULL,
    action_category VARCHAR(50),  -- 'user', 'violation', 'settings', 'block'

    target_type VARCHAR(50),
    target_id VARCHAR(100),

    details JSONB,
    ip_address INET,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_audit_admin ON admin_audit_log(admin_id);
CREATE INDEX idx_audit_created ON admin_audit_log(created_at);
CREATE INDEX idx_audit_action ON admin_audit_log(action_category, action);
```

---

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)

```env
# ===========================================
# Anti-Abuse Configuration
# ===========================================

# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
ANTI_ABUSE_ENABLED=true
ANTI_ABUSE_DETECTION_INTERVAL_SECONDS=60

# –ü–æ—Ä–æ–≥–∏ —Å–∫–æ—Ä–∏–Ω–≥–∞
ANTI_ABUSE_THRESHOLD_MONITOR=30
ANTI_ABUSE_THRESHOLD_WARN=50
ANTI_ABUSE_THRESHOLD_SOFT_LIMIT=65
ANTI_ABUSE_THRESHOLD_TEMP_BLOCK=80
ANTI_ABUSE_THRESHOLD_HARD_BLOCK=95

# –í–µ—Å–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤
ANTI_ABUSE_WEIGHT_TEMPORAL=0.25
ANTI_ABUSE_WEIGHT_GEO=0.25
ANTI_ABUSE_WEIGHT_ASN=0.15
ANTI_ABUSE_WEIGHT_PROFILE=0.20
ANTI_ABUSE_WEIGHT_DEVICE=0.15

# –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
ANTI_ABUSE_MOBILE_CARRIER_MULTIPLIER=0.7
ANTI_ABUSE_DATACENTER_MULTIPLIER=1.5
ANTI_ABUSE_VPN_MULTIPLIER=1.2

# –ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞
ANTI_ABUSE_AUTO_ACTION_CONFIDENCE=0.85
ANTI_ABUSE_REQUIRE_HUMAN_CONFIDENCE=0.70

# –ü–∞–º—è—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–π
ANTI_ABUSE_VIOLATION_MEMORY_DAYS=30
ANTI_ABUSE_CLEAN_RESET_DAYS=60

# Grace period –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
ANTI_ABUSE_NEW_USER_GRACE_DAYS=7

# ===========================================
# GeoIP Configuration
# ===========================================
GEOIP_ENABLED=true
GEOIP_PROVIDER=maxmind  # –∏–ª–∏ 'ipapi', 'ipinfo'
GEOIP_DATABASE_PATH=/data/GeoLite2-City.mmdb
GEOIP_API_KEY=your_api_key  # –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

# ===========================================
# Web Panel Configuration
# ===========================================
WEB_PANEL_ENABLED=true
WEB_PANEL_HOST=0.0.0.0
WEB_PANEL_PORT=8081
WEB_PANEL_SECRET_KEY=your-very-secret-key-change-me
WEB_PANEL_JWT_EXPIRY_HOURS=24
WEB_PANEL_JWT_REFRESH_DAYS=7
WEB_PANEL_CORS_ORIGINS=["http://localhost:3000", "https://admin.yourdomain.com"]

# ===========================================
# Notifications (Admin only)
# ===========================================
NOTIFICATIONS_TOPIC_VIOLATIONS=your_violations_topic_id
NOTIFICATIONS_ADMIN_ON_BLOCK=true
NOTIFICATIONS_ADMIN_ON_UNBLOCK=true
NOTIFICATIONS_ADMIN_ON_APPEAL=true

# Discord (optional)
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/...
DISCORD_NOTIFY_VIOLATIONS=true
DISCORD_NOTIFY_BLOCKS=true

# Email (optional)
SMTP_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your@email.com
SMTP_PASSWORD=your_password
SMTP_FROM=noreply@yourdomain.com
EMAIL_NOTIFY_CRITICAL=admin@yourdomain.com
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

1. **services/api_client.py**
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_online_users()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_user_connections()` –µ—Å–ª–∏ API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç

2. **services/webhook.py**
   - –†–∞—Å—à–∏—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π `user.connected`, `user.disconnected`
   - –î–æ–±–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ IP –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–æ–±—ã—Ç–∏–π

3. **services/database.py**
   - –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å violations, blocks, appeals
   - –ú–µ—Ç–æ–¥—ã –¥–ª—è user_behavior_profiles

4. **–ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
   - `services/violation_detector.py` ‚Äî –º–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
   - `services/auto_blocker.py` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
   - `services/geoip.py` ‚Äî –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è IP
   - `services/trust_score.py` ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
   - `services/appeal_handler.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–ø–µ–ª–ª—è—Ü–∏–π

5. **handlers/**
   - –ù–æ–≤—ã–π `handlers/antiabuse.py` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Anti-Abuse –≤ Telegram
   - –†–∞—Å—à–∏—Ä–∏—Ç—å `handlers/users.py` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å Anti-Abuse –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ Feature Flags

```python
# config.py
class Settings:
    # Feature flags
    anti_abuse_enabled: bool = True
    anti_abuse_auto_block_enabled: bool = True
    geoip_enabled: bool = True
    web_panel_enabled: bool = False
    trust_score_enabled: bool = True
    appeals_enabled: bool = True  # –ê–ø–µ–ª–ª—è—Ü–∏–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–æ–≤
```

–í—Å–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã:
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å feature flag –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- Gracefully degradate –µ—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- –ù–µ –≤–ª–∏—è—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç—É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å:
- `README.md` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- `CHANGELOG.md` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `docs/anti-abuse.md` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Anti-Abuse —Å–∏—Å—Ç–µ–º—ã
- `docs/api.md` ‚Äî OpenAPI/Swagger —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
- `docs/configuration.md` ‚Äî –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `docs/troubleshooting.md` ‚Äî —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

---

*–î–æ–∫—É–º–µ–Ω—Ç –≤–µ—Ä—Å–∏–∏ 2.0. –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 26.01.2026*
