# üìã –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è Remnawave Admin Bot

> **–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 26.01.2026
> **–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 1.5.x

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- Telegram –±–æ—Ç –Ω–∞ aiogram 3.12 —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é
- PostgreSQL –±–∞–∑–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ users, nodes, hosts, user_connections
- REST API –∫–ª–∏–µ–Ω—Ç –∫ Remnawave (~60 –º–µ—Ç–æ–¥–æ–≤)
- Webhook —Å–µ—Ä–≤–µ—Ä –¥–ª—è real-time —Å–æ–±—ã—Ç–∏–π
- HWID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ/–ª–∏–º–∏—Ç—ã)
- –¢–∞–±–ª–∏—Ü–∞ `user_connections` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è IP –∞–¥—Ä–µ—Å–æ–≤
- –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Ç–æ–ø–∏–∫–∞–º
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### ‚ùå –ß–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ IP –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ IP
- –°–∏—Å—Ç–µ–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ü–µ–ª–∏

1. **Anti-Abuse —Å–∏—Å—Ç–µ–º–∞** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç —à–∞—Ä–∏–Ω–≥–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
2. **–í–µ–±-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π UI –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç—á—ë—Ç—ã
4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

---

## üöÄ –§–∞–∑–∞ 1: Anti-Abuse —Å–∏—Å—Ç–µ–º–∞ (–í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)

### 1.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ IP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–¶–µ–ª—å:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ó–∞–¥–∞—á–∏:**

```
[ ] –†–∞—Å—à–∏—Ä–∏—Ç—å webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–±—ã—Ç–∏–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É user.connected / user.disconnected —Å–æ–±—ã—Ç–∏–π
    - –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å IP, –≤—Ä–µ–º—è, –Ω–æ–¥—É –≤ user_connections

[ ] –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å ConnectionMonitor
    - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (–∫–∞–∂–¥—ã–µ 30-60 —Å–µ–∫)
    - –ó–∞–ø—Ä–æ—Å –∫ Remnawave API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è online –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–æ–≤ —Å HWID –ª–∏–º–∏—Ç–æ–º

[ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ database.py:
    - get_active_connections_count(user_uuid) -> int
    - get_unique_ips_in_window(user_uuid, window_minutes=5) -> int
    - is_user_over_device_limit(user_uuid) -> bool
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```python
class ConnectionEvent:
    user_uuid: str
    ip_address: str
    node_uuid: str
    connected_at: datetime
    device_fingerprint: Optional[str]  # –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

class DeviceLimitViolation:
    user_uuid: str
    hwid_limit: int
    actual_ips: int
    ip_addresses: List[str]
    detected_at: datetime
    auto_action: str  # 'warn', 'temp_block', 'permanent_block'
```

### 1.2 –°–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π

**–¶–µ–ª—å:** –í—ã—è–≤–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–µ–≤ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–õ–æ–≥–∏–∫–∞ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
–ï–°–õ–ò hwid_device_limit = 3 –ò —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö_IP_–∑–∞_5_–º–∏–Ω—É—Ç >= 5
–¢–û —ç—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ (—à–∞—Ä–∏–Ω–≥ –∞–∫–∫–∞—É–Ω—Ç–∞)
```

**–ó–∞–¥–∞—á–∏:**

```
[ ] –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å ViolationDetector (services/violation_detector.py)
    - check_user_violations(user_uuid) -> Optional[Violation]
    - get_all_violations(since_hours=24) -> List[Violation]
    - calculate_severity(violation) -> ViolationSeverity

[ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π:
    - LOW: IP = limit + 1 (–≤–æ–∑–º–æ–∂–Ω–æ, —Å–º–µ–Ω–∞ —Å–µ—Ç–∏)
    - MEDIUM: IP = limit + 2 (–≤–µ—Ä–æ—è—Ç–Ω—ã–π —à–∞—Ä–∏–Ω–≥)
    - HIGH: IP >= limit * 2 (—è–≤–Ω—ã–π —à–∞—Ä–∏–Ω–≥)
    - CRITICAL: IP >= limit * 3 (–º–∞—Å—Å–æ–≤—ã–π —à–∞—Ä–∏–Ω–≥)

[ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É violations –≤ –ë–î:
    CREATE TABLE violations (
        id SERIAL PRIMARY KEY,
        user_uuid UUID NOT NULL,
        violation_type VARCHAR(50),
        severity VARCHAR(20),
        hwid_limit INT,
        detected_ips INT,
        ip_addresses JSONB,
        action_taken VARCHAR(50),
        created_at TIMESTAMP DEFAULT NOW(),
        resolved_at TIMESTAMP,
        resolved_by BIGINT  -- admin telegram_id
    );
```

### 1.3 –ú–µ—Ö–∞–Ω–∏–∑–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π

**–ó–∞–¥–∞—á–∏:**

```
[ ] –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å AutoBlocker (services/auto_blocker.py)
    - schedule_temp_block(user_uuid, duration_hours, reason)
    - execute_block(user_uuid) -> bool
    - schedule_unblock(user_uuid, unblock_at)
    - execute_unblock(user_uuid) -> bool

[ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É temp_blocks –≤ –ë–î:
    CREATE TABLE temp_blocks (
        id SERIAL PRIMARY KEY,
        user_uuid UUID NOT NULL,
        reason VARCHAR(255),
        violation_id INT REFERENCES violations(id),
        blocked_at TIMESTAMP DEFAULT NOW(),
        unblock_at TIMESTAMP NOT NULL,
        actual_unblock_at TIMESTAMP,
        blocked_by VARCHAR(50),  -- 'auto' –∏–ª–∏ admin telegram_id
        is_active BOOLEAN DEFAULT TRUE
    );

[ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Remnawave API:
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å disable_user() –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enable_user() –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    - –î–æ–±–∞–≤–∏—Ç—å –≤ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

[ ] –°–æ–∑–¥–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É UnblockScheduler:
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
```

**–ü—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**

| –ù–∞—Ä—É—à–µ–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
|-----------|----------|--------------|
| –ü–µ—Ä–≤–æ–µ (LOW) | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ | ‚Äî |
| –ü–µ—Ä–≤–æ–µ (MEDIUM+) | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | 1 —á–∞—Å |
| –í—Ç–æ—Ä–æ–µ | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | 6 —á–∞—Å–æ–≤ |
| –¢—Ä–µ—Ç—å–µ | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | 24 —á–∞—Å–∞ |
| –ß–µ—Ç–≤—ë—Ä—Ç–æ–µ+ | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | 7 –¥–Ω–µ–π |

### 1.4 –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Anti-Abuse

**–ó–∞–¥–∞—á–∏:**

```
[ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É anti_abuse_settings:
    CREATE TABLE anti_abuse_settings (
        id SERIAL PRIMARY KEY,
        setting_key VARCHAR(100) UNIQUE,
        setting_value JSONB,
        updated_at TIMESTAMP DEFAULT NOW(),
        updated_by BIGINT
    );

[ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - detection_window_minutes: 5 (–æ–∫–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∏)
    - ip_tolerance: 1 (–¥–æ–ø—É—Å—Ç–∏–º–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ)
    - auto_block_enabled: true
    - first_violation_action: 'warn' | 'block_1h'
    - notification_on_violation: true
    - whitelist_user_uuids: []  (–∏—Å–∫–ª—é—á–µ–Ω–∏—è)

[ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤ Telegram –±–æ—Ç:
    - /antiabuse_settings ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
    - /antiabuse_stats ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π
    - /antiabuse_whitelist ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏
```

### 1.5 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö

**–ó–∞–¥–∞—á–∏:**

```
[ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–ø–∏–∫ notifications_topic_violations

[ ] –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
    üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

    üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @username
    üìä –õ–∏–º–∏—Ç HWID: 3
    üåê –ê–∫—Ç–∏–≤–Ω—ã—Ö IP: 5
    üìç IP –∞–¥—Ä–µ—Å–∞:
       ‚Ä¢ 185.xxx.xxx.1 (RU, Moscow)
       ‚Ä¢ 185.xxx.xxx.2 (RU, SPB)
       ‚Ä¢ 91.xxx.xxx.3 (DE, Berlin)
       ‚Ä¢ 91.xxx.xxx.4 (DE, Frankfurt)
       ‚Ä¢ 45.xxx.xxx.5 (NL, Amsterdam)

    ‚ö†Ô∏è –£—Ä–æ–≤–µ–Ω—å: MEDIUM
    üîí –î–µ–π—Å—Ç–≤–∏–µ: –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 1 —á–∞—Å
    ‚è∞ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞: 26.01.2026 15:30 UTC

[ ] –î–æ–±–∞–≤–∏—Ç—å inline-–∫–Ω–æ–ø–∫–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:
    [‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å] [‚è∞ –ü—Ä–æ–¥–ª–∏—Ç—å –±–ª–æ–∫] [üö´ –ü–µ—Ä–º–∞–±–∞–Ω]
```

### 1.6 –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ Telegram

**–ó–∞–¥–∞—á–∏:**

```
[ ] –ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é: "üõ° Anti-Abuse"
    ‚îú‚îÄ‚îÄ üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π
    ‚îÇ   ‚îú‚îÄ‚îÄ –ó–∞ —Å–µ–≥–æ–¥–Ω—è
    ‚îÇ   ‚îú‚îÄ‚îÄ –ó–∞ –Ω–µ–¥–µ–ª—é
    ‚îÇ   ‚îî‚îÄ‚îÄ –ó–∞ –º–µ—Å—è—Ü
    ‚îú‚îÄ‚îÄ üî¥ –ê–∫—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    ‚îÇ   ‚îî‚îÄ‚îÄ [–°–ø–∏—Å–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏]
    ‚îú‚îÄ‚îÄ üìã –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π
    ‚îÇ   ‚îî‚îÄ‚îÄ [–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é/–¥–∞—Ç–µ]
    ‚îú‚îÄ‚îÄ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ –û–∫–Ω–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îÇ   ‚îú‚îÄ‚îÄ –î–æ–ø—É—Å–∫ IP
    ‚îÇ   ‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–∫–ª/–≤—ã–∫–ª
    ‚îÇ   ‚îî‚îÄ‚îÄ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
    ‚îî‚îÄ‚îÄ üìù Whitelist
        ‚îú‚îÄ‚îÄ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        ‚îî‚îÄ‚îÄ –°–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

[ ] –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
    - –°–µ–∫—Ü–∏—è "–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π"
    - –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ whitelist"
    - –°—Ç–∞—Ç—É—Å —Ç–µ–∫—É—â–µ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
```

---

## üöÄ –§–∞–∑–∞ 2: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### 2.1 –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è IP

**–ó–∞–¥–∞—á–∏:**

```
[ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å GeoIP –±–∞–∑—É (MaxMind GeoLite2 –∏–ª–∏ ip-api.com)

[ ] –î–æ–±–∞–≤–∏—Ç—å –≤ user_connections:
    - country_code VARCHAR(2)
    - city VARCHAR(100)
    - asn VARCHAR(100)  -- –ø—Ä–æ–≤–∞–π–¥–µ—Ä

[ ] –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:
    - –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
    - VPN/Proxy –¥–µ—Ç–µ–∫—Ü–∏—è –ø–æ ASN
    - Impossible travel (–Ω–µ—Ä–µ–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ)
```

### 2.2 –î–∞—à–±–æ—Ä–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ó–∞–¥–∞—á–∏:**

```
[ ] –†–∞—Å—à–∏—Ä–∏—Ç—å /system –∫–æ–º–∞–Ω–¥—É:
    - –¢–æ–ø-10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É IP
    - –¢–æ–ø-10 –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π –∑–∞ –ø–µ—Ä–∏–æ–¥
    - –ì—Ä–∞—Ñ–∏–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø–æ –¥–Ω—è–º
    - –ö–∞—Ä—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–æ —Å—Ç—Ä–∞–Ω–∞–º

[ ] –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤:
    - CSV —ç–∫—Å–ø–æ—Ä—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π
    - –°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥
```

### 2.3 –°–∏—Å—Ç–µ–º–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ó–∞–¥–∞—á–∏:**

```
[ ] –î–æ–±–∞–≤–∏—Ç—å trust_score –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
    - –ù–∞—á–∞–ª—å–Ω—ã–π —Å–∫–æ—Ä: 100
    - –ù–∞—Ä—É—à–µ–Ω–∏–µ LOW: -5
    - –ù–∞—Ä—É—à–µ–Ω–∏–µ MEDIUM: -15
    - –ù–∞—Ä—É—à–µ–Ω–∏–µ HIGH: -30
    - –ú–µ—Å—è—Ü –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π: +10

[ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ —Å–∫–æ—Ä—É:
    - < 50: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ HWID –ª–∏–º–∏—Ç–∞
    - < 20: —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    - 0: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–∞–Ω
```

---

## üöÄ –§–∞–∑–∞ 3: –í–µ–±-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 3.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–µ–±-–ø–∞–Ω–µ–ª–∏

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:**
```
Backend:  FastAPI (—É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –µ—Å—Ç—å –¥–ª—è webhook)
Frontend: React/Vue.js + TailwindCSS
Auth:     Telegram Login Widget + JWT
DB:       PostgreSQL (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
Realtime: WebSocket –¥–ª—è live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```
remnawave-admin/
‚îú‚îÄ‚îÄ src/                    # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π Telegram –±–æ—Ç
‚îú‚îÄ‚îÄ web/                    # –ù–æ–≤–∞—è –≤–µ–±-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nodes.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ violations.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ frontend/
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îÇ       ‚îú‚îÄ‚îÄ package.json
‚îÇ       ‚îî‚îÄ‚îÄ vite.config.ts
‚îî‚îÄ‚îÄ docker-compose.yml      # –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å –≤–µ–±-—Å–µ—Ä–≤–∏—Å–∞–º–∏
```

### 3.2 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–ó–∞–¥–∞—á–∏:**

```
[ ] Telegram Login Widget –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ hash –æ—Ç Telegram
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ telegram_id –≤ —Å–ø–∏—Å–∫–µ –∞–¥–º–∏–Ω–æ–≤
    - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞

[ ] –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å:
    - SUPER_ADMIN: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
    - ADMIN: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –Ω–æ–¥–∞–º–∏
    - MODERATOR: —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    - VIEWER: —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä

[ ] –¢–∞–±–ª–∏—Ü–∞ admin_sessions:
    CREATE TABLE admin_sessions (
        id SERIAL PRIMARY KEY,
        telegram_id BIGINT NOT NULL,
        jwt_token_hash VARCHAR(64),
        created_at TIMESTAMP DEFAULT NOW(),
        expires_at TIMESTAMP,
        ip_address INET,
        user_agent TEXT,
        is_active BOOLEAN DEFAULT TRUE
    );
```

### 3.3 –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–µ–±-–ø–∞–Ω–µ–ª–∏

**Dashboard (–ì–ª–∞–≤–Ω–∞—è)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìä Dashboard                                    [Admin ‚ñº]  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ  ‚îÇ 1,234    ‚îÇ ‚îÇ 45       ‚îÇ ‚îÇ 12       ‚îÇ ‚îÇ 3        ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ Users    ‚îÇ ‚îÇ Online   ‚îÇ ‚îÇ Nodes    ‚îÇ ‚îÇ Alerts   ‚îÇ       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Traffic (24h)               ‚îÇ ‚îÇ Violations (7d)        ‚îÇ‚îÇ
‚îÇ  ‚îÇ [=========== Graph ======]  ‚îÇ ‚îÇ [====== Chart ======]  ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Recent Activity                                         ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ User @john connected from 185.x.x.x          2m ago  ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ‚ö†Ô∏è Violation detected for @alice             5m ago  ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Node DE-1 restarted                         10m ago  ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ó–∞–¥–∞—á–∏ —Å—Ç—Ä–∞–Ω–∏—Ü:**

```
[ ] Dashboard
    - –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    - –ì—Ä–∞—Ñ–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
    - –õ–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    - –ö–∞—Ä—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–æ —Å—Ç—Ä–∞–Ω–∞–º

[ ] Users Management
    - –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
    - –ü–æ–∏—Å–∫ (username, email, telegram_id)
    - Inline —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    - Bulk –æ–ø–µ—Ä–∞—Ü–∏–∏
    - –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

[ ] Nodes Management
    - –°–ø–∏—Å–æ–∫ –Ω–æ–¥ —Å —Å—Ç–∞—Ç—É—Å–∞–º–∏
    - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≤–∫–ª/–≤—ã–∫–ª/—Ä–µ—Å—Ç–∞—Ä—Ç)
    - –ì—Ä–∞—Ñ–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø–æ –Ω–æ–¥–∞–º
    - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ config profiles

[ ] Anti-Abuse Center
    - Live-–º–æ–Ω–∏—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
    - –°–ø–∏—Å–æ–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
    - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    - Whitelist —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

[ ] Analytics
    - –û—Ç—á—ë—Ç—ã –ø–æ —Ç—Ä–∞—Ñ–∏–∫—É
    - –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - –¢—Ä–µ–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    - –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

[ ] Settings
    - –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
    - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏
    - API —Ç–æ–∫–µ–Ω—ã
    - Webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

### 3.4 Real-time —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–ó–∞–¥–∞—á–∏:**

```
[ ] WebSocket —Å–µ—Ä–≤–µ—Ä –¥–ª—è live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:
    - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - –°—Ç–∞—Ç—É—Å—ã –Ω–æ–¥
    - –ù–æ–≤—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è
    - –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

[ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º webhook:
    - Broadcast —Å–æ–±—ã—Ç–∏–π –≤ WebSocket
    - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π
```

### 3.5 API –¥–ª—è –≤–µ–±-–ø–∞–Ω–µ–ª–∏

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

```
# Auth
POST   /api/v1/auth/telegram      # Telegram Login
POST   /api/v1/auth/refresh       # Refresh JWT
POST   /api/v1/auth/logout        # Logout

# Users
GET    /api/v1/users              # List users (paginated)
GET    /api/v1/users/:uuid        # Get user details
PATCH  /api/v1/users/:uuid        # Update user
POST   /api/v1/users/:uuid/block  # Block user
POST   /api/v1/users/:uuid/unblock# Unblock user
GET    /api/v1/users/:uuid/connections  # User connections history

# Nodes
GET    /api/v1/nodes              # List nodes
GET    /api/v1/nodes/:uuid        # Node details
POST   /api/v1/nodes/:uuid/restart# Restart node
PATCH  /api/v1/nodes/:uuid/status # Enable/disable

# Violations
GET    /api/v1/violations         # List violations
GET    /api/v1/violations/:id     # Violation details
POST   /api/v1/violations/:id/resolve  # Resolve violation

# Blocks
GET    /api/v1/blocks             # Active blocks
POST   /api/v1/blocks             # Create manual block
DELETE /api/v1/blocks/:id         # Remove block

# Analytics
GET    /api/v1/analytics/traffic  # Traffic stats
GET    /api/v1/analytics/connections  # Connection stats
GET    /api/v1/analytics/violations   # Violation stats
GET    /api/v1/analytics/geo      # Geo distribution

# Settings
GET    /api/v1/settings           # All settings
PATCH  /api/v1/settings/:key      # Update setting

# WebSocket
WS     /api/v1/ws                 # Real-time events
```

---

## üöÄ –§–∞–∑–∞ 4: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 4.1 –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞

**–ó–∞–¥–∞—á–∏:**

```
[ ] –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª (Rules Engine):
    - IF condition THEN action
    - –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–∞–≤–∏–ª
    - –ü—Ä–∏–º–µ—Ä—ã:
      * IF unique_ips > hwid_limit * 2 THEN block_24h
      * IF country NOT IN ['RU', 'UA', 'BY'] THEN notify
      * IF traffic_today > 100GB THEN warn

[ ] Scheduled tasks:
    - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    - –ë—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
```

### 4.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–ó–∞–¥–∞—á–∏:**

```
[ ] Discord webhook –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
[ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (SMTP)
[ ] Slack –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
[ ] Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Grafana
[ ] API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º (—Å rate limiting)
```

### 4.3 –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

**–ó–∞–¥–∞—á–∏:**

```
[ ] PWA (Progressive Web App)
    - –†–∞–±–æ—Ç–∞ offline
    - Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω

[ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
```

---

## üìÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–§–∞–∑–∞ 1)
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ IP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π** ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–ª—è –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π** ‚Äî –≤—ã—è–≤–ª–µ–Ω–∏–µ —à–∞—Ä–∏–Ω–≥–∞
3. **–ú–µ—Ö–∞–Ω–∏–∑–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–§–∞–∑–∞ 2-3)
5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Anti-Abuse** ‚Äî –≥–∏–±–∫–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
6. **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è IP** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
7. **–í–µ–±-–ø–∞–Ω–µ–ª—å Backend** ‚Äî API –¥–ª—è UI
8. **–í–µ–±-–ø–∞–Ω–µ–ª—å Frontend** ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–§–∞–∑–∞ 4)
9. **Rules Engine** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
10. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
11. **PWA** ‚Äî –º–æ–±–∏–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø

---

## üóÉÔ∏è –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–∏–≥—Ä–∞—Ü–∏—è 0003: Anti-Abuse —Å–∏—Å—Ç–µ–º–∞

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π
CREATE TABLE violations (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,
    violation_type VARCHAR(50) NOT NULL,
    severity VARCHAR(20) NOT NULL,
    hwid_limit INT NOT NULL,
    detected_ips INT NOT NULL,
    ip_addresses JSONB NOT NULL,
    action_taken VARCHAR(50),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    resolved_at TIMESTAMP WITH TIME ZONE,
    resolved_by BIGINT,
    notes TEXT
);

CREATE INDEX idx_violations_user_uuid ON violations(user_uuid);
CREATE INDEX idx_violations_created_at ON violations(created_at);
CREATE INDEX idx_violations_severity ON violations(severity);

-- –¢–∞–±–ª–∏—Ü–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
CREATE TABLE temp_blocks (
    id SERIAL PRIMARY KEY,
    user_uuid UUID NOT NULL,
    reason VARCHAR(255) NOT NULL,
    violation_id INT REFERENCES violations(id),
    blocked_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    unblock_at TIMESTAMP WITH TIME ZONE NOT NULL,
    actual_unblock_at TIMESTAMP WITH TIME ZONE,
    blocked_by VARCHAR(50) NOT NULL,
    is_active BOOLEAN DEFAULT TRUE
);

CREATE INDEX idx_temp_blocks_user_uuid ON temp_blocks(user_uuid);
CREATE INDEX idx_temp_blocks_unblock_at ON temp_blocks(unblock_at);
CREATE INDEX idx_temp_blocks_is_active ON temp_blocks(is_active);

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Anti-Abuse
CREATE TABLE anti_abuse_settings (
    id SERIAL PRIMARY KEY,
    setting_key VARCHAR(100) UNIQUE NOT NULL,
    setting_value JSONB NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_by BIGINT
);

-- Whitelist –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE anti_abuse_whitelist (
    id SERIAL PRIMARY KEY,
    user_uuid UUID UNIQUE NOT NULL,
    added_by BIGINT NOT NULL,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    reason TEXT
);

-- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ user_connections –¥–ª—è –≥–µ–æ-–¥–∞–Ω–Ω—ã—Ö
ALTER TABLE user_connections
ADD COLUMN IF NOT EXISTS country_code VARCHAR(2),
ADD COLUMN IF NOT EXISTS city VARCHAR(100),
ADD COLUMN IF NOT EXISTS asn VARCHAR(100);
```

### –ú–∏–≥—Ä–∞—Ü–∏—è 0004: –í–µ–±-–ø–∞–Ω–µ–ª—å

```sql
-- –ê–¥–º–∏–Ω —Ä–æ–ª–∏
CREATE TYPE admin_role AS ENUM ('super_admin', 'admin', 'moderator', 'viewer');

-- –°–µ—Å—Å–∏–∏ –∞–¥–º–∏–Ω–æ–≤
CREATE TABLE admin_sessions (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT NOT NULL,
    role admin_role NOT NULL DEFAULT 'viewer',
    jwt_token_hash VARCHAR(64),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
    last_activity_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    ip_address INET,
    user_agent TEXT,
    is_active BOOLEAN DEFAULT TRUE
);

CREATE INDEX idx_admin_sessions_telegram_id ON admin_sessions(telegram_id);
CREATE INDEX idx_admin_sessions_is_active ON admin_sessions(is_active);

-- –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–æ–≤
CREATE TABLE admin_audit_log (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT NOT NULL,
    action VARCHAR(100) NOT NULL,
    target_type VARCHAR(50),
    target_id VARCHAR(100),
    details JSONB,
    ip_address INET,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_audit_log_telegram_id ON admin_audit_log(telegram_id);
CREATE INDEX idx_audit_log_created_at ON admin_audit_log(created_at);
```

---

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Anti-Abuse
ANTI_ABUSE_ENABLED=true
ANTI_ABUSE_DETECTION_WINDOW_MINUTES=5
ANTI_ABUSE_IP_TOLERANCE=1
ANTI_ABUSE_AUTO_BLOCK_ENABLED=true
ANTI_ABUSE_NOTIFICATION_TOPIC=violations

# GeoIP
GEOIP_ENABLED=true
GEOIP_DATABASE_PATH=/data/GeoLite2-City.mmdb
# –∏–ª–∏
GEOIP_API_URL=http://ip-api.com/json

# Web Panel
WEB_PANEL_ENABLED=true
WEB_PANEL_PORT=8081
WEB_PANEL_HOST=0.0.0.0
WEB_PANEL_SECRET_KEY=your-secret-key
WEB_PANEL_JWT_EXPIRY_HOURS=24
WEB_PANEL_CORS_ORIGINS=["http://localhost:3000"]
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

1. **api_client.py** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è online –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **webhook.py** ‚Äî —Ä–∞—Å—à–∏—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
3. **database.py** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –º–µ—Ç–æ–¥—ã
4. **notifications.py** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ø–∏–∫ –¥–ª—è –Ω–∞—Ä—É—à–µ–Ω–∏–π
5. **main.py** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (ViolationDetector, AutoBlocker)

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- –í—Å–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ (feature flags)
- –í–µ–±-–ø–∞–Ω–µ–ª—å –Ω–µ –¥–æ–ª–∂–Ω–∞ –≤–ª–∏—è—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç—É Telegram –±–æ—Ç–∞
- Graceful degradation –µ—Å–ª–∏ –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã –æ–±–Ω–æ–≤–ª—è—Ç—å:
- README.md ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- CHANGELOG.md ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (OpenAPI/Swagger)
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

*–î–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞.*
